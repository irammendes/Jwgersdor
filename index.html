<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador Inteligente Lotofácil</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #2980b9;
            --dark-color: #34495e;
            --light-color: #ecf0f1;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9f9f9;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        h1, h2, h3 {
            color: var(--dark-color);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-color);
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 10px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        button.secondary {
            background-color: var(--secondary-color);
        }
        
        button.secondary:hover {
            background-color: #27ae60;
        }
        
        button.danger {
            background-color: var(--danger-color);
        }
        
        button.danger:hover {
            background-color: #c0392b;
        }
        
        .number-ball {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            margin: 5px;
            font-weight: bold;
            color: white;
            background-color: var(--primary-color);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .number-ball:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .number-ball.selected {
            background-color: var(--dark-color);
            transform: scale(1.1);
        }
        
        .number-ball.prime {
            background-color: var(--secondary-color);
        }
        
        .number-ball.hot {
            background-color: var(--danger-color);
        }
        
        .number-ball.cold {
            background-color: var(--info-color);
        }
        
        .number-ball.extreme {
            background-color: var(--warning-color);
        }
        
        .panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary-color);
        }
        
        .panel-title {
            margin-top: 0;
            color: var(--primary-color);
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .game-report {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--secondary-color);
        }
        
        .game-title {
            margin-top: 0;
            color: var(--dark-color);
        }
        
        .stat-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .stat-table th, .stat-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        
        .stat-table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
        }
        
        .stat-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .stat-table tr:hover {
            background-color: #e9e9e9;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #f1f1f1;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        
        .tab.active {
            background: var(--primary-color);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .badge {
            display: inline-block;
            padding: 3px 7px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: bold;
            background-color: var(--light-color);
            color: var(--dark-color);
        }
        
        .badge.primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .badge.success {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .badge.warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .badge.danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .progress {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            background-color: var(--primary-color);
        }
        
        @media (max-width: 768px) {
            .button-group {
                flex-direction: column;
            }
            
            .number-ball {
                width: 30px;
                height: 30px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gerador Inteligente de Jogos Lotofácil</h1>
        
        <div class="panel">
            <h2 class="panel-title">Controle</h2>
            <div class="button-group">
                <button onclick="loadHistoricalData()">Atualizar Sorteios</button>
                <button class="secondary" onclick="generateSmartGames()">Gerar Jogos Inteligentes</button>
                <button class="danger" onclick="clearGames()">Limpar Jogos</button>
                <button onclick="saveGames()">Salvar Jogos</button>
                <button onclick="loadSavedGames()">Carregar Jogos</button>
            </div>
            
            <div class="button-group">
                <button onclick="selectHotNumbers()">Selecionar Quentes</button>
                <button onclick="selectColdNumbers()">Selecionar Frios</button>
                <button onclick="selectPrimeNumbers()">Selecionar Primos</button>
                <button onclick="clearSelection()">Limpar Seleção</button>
            </div>
        </div>
        
        <div class="panel">
            <h2 class="panel-title">Números</h2>
            <div id="number-cards"></div>
            <div class="button-group">
                <button onclick="generateFromSelection()">Gerar com Seleção</button>
                <button onclick="generateRandomGames()">Gerar Aleatórios</button>
            </div>
            <p>Números selecionados: <span id="selected-count">0</span>/15</p>
            <div class="progress">
                <div id="selection-progress" class="progress-bar" style="width: 0%"></div>
            </div>
        </div>
        
        <div class="panel">
            <h2 class="panel-title">Jogos Gerados</h2>
            <div id="generated-games"></div>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('stats')">Estatísticas</div>
            <div class="tab" onclick="switchTab('frequency')">Frequência</div>
            <div class="tab" onclick="switchTab('patterns')">Padrões</div>
        </div>
        
        <div id="stats-tab" class="tab-content active">
            <div class="panel">
                <h2 class="panel-title">Estatísticas dos Últimos Sorteios</h2>
                <table class="stat-table" id="stat-table"></table>
            </div>
            
            <div class="grid">
                <div class="panel">
                    <h2 class="panel-title">Distribuição de Frequência</h2>
                    <div class="chart-container">
                        <canvas id="frequency-chart"></canvas>
                    </div>
                </div>
                
                <div class="panel">
                    <h2 class="panel-title">Tendência de Números</h2>
                    <div class="chart-container">
                        <canvas id="trend-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="frequency-tab" class="tab-content">
            <div class="panel">
                <h2 class="panel-title">Análise de Frequência</h2>
                <div class="chart-container">
                    <canvas id="heatmap-chart"></canvas>
                </div>
            </div>
        </div>
        
        <div id="patterns-tab" class="tab-content">
            <div class="panel">
                <h2 class="panel-title">Padrões Comuns</h2>
                <div class="grid">
                    <div class="panel">
                        <h3>Pares vs Ímpares</h3>
                        <div class="chart-container">
                            <canvas id="parity-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="panel">
                        <h3>Distribuição por Dezenas</h3>
                        <div class="chart-container">
                            <canvas id="decades-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="panel">
                    <h3>Números por Linha</h3>
                    <div class="chart-container">
                        <canvas id="lines-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // Constantes e configurações
    const MAX_NUMBERS = 25;
    const GAME_SIZE = 15;
    const MAX_GAMES = 10;
    const PRIME_NUMBERS = [2, 3, 5, 7, 11, 13, 17, 19, 23];
    const EXTREME_NUMBERS = [1, 2, 3, 23, 24, 25];
    
    // Estado da aplicação
    let lastDraws = [];
    let frequencyData = Array(MAX_NUMBERS).fill(0);
    let selectedNumbers = [];
    let generatedGames = [];
    let charts = {};
    
    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
        loadHistoricalData();
        setupEventListeners();
    });
    
    // Configura listeners de eventos
    function setupEventListeners() {
        // Teclas de atalho
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') generateSmartGames();
            if (e.key === 'Escape') clearSelection();
        });
    }
    
    // Carrega dados históricos (simulados ou reais)
    function loadHistoricalData() {
        // Simulação de dados históricos
        const mockData = {
            draws: Array.from({length: 30}, (_, i) => {
                const date = new Date();
                date.setDate(date.getDate() - (30 - i));
                return {
                    date: date.toLocaleDateString(),
                    numbers: generateRandomGame().sort((a, b) => a - b)
                };
            })
        };
        
        lastDraws = mockData.draws;
        updateFrequencyData();
        renderAll();
    }
    
    // Atualiza dados de frequência
    function updateFrequencyData() {
        frequencyData = Array(MAX_NUMBERS).fill(0);
        lastDraws.forEach(draw => {
            draw.numbers.forEach(num => frequencyData[num - 1]++);
        });
    }
    
    // Renderiza todos os componentes
    function renderAll() {
        renderNumberCards();
        renderStatistics();
        renderGeneratedGames();
        updateCharts();
        updateSelectionCount();
    }
    
    // Renderiza os números selecionáveis
    function renderNumberCards() {
        const container = document.getElementById('number-cards');
        container.innerHTML = '';
        
        for (let i = 1; i <= MAX_NUMBERS; i++) {
            const div = document.createElement('div');
            div.className = `number-ball ${getNumberClass(i)} ${selectedNumbers.includes(i) ? 'selected' : ''}`;
            div.textContent = i;
            div.title = getNumberTooltip(i);
            div.onclick = () => toggleSelection(i);
            container.appendChild(div);
        }
    }
    
    // Retorna a classe CSS para um número baseado em suas propriedades
    function getNumberClass(number) {
        const index = number - 1;
        const frequency = frequencyData[index];
        const avgFrequency = lastDraws.length * GAME_SIZE / MAX_NUMBERS;
        
        if (PRIME_NUMBERS.includes(number)) return 'prime';
        if (EXTREME_NUMBERS.includes(number)) return 'extreme';
        if (frequency >= avgFrequency * 1.5) return 'hot';
        if (frequency <= avgFrequency * 0.5) return 'cold';
        return '';
    }
    
    // Retorna tooltip para um número
    function getNumberTooltip(number) {
        const index = number - 1;
        const frequency = frequencyData[index];
        const lastDraw = lastDraws.find(draw => draw.numbers.includes(number));
        
        let tooltip = `Número ${number}\n`;
        tooltip += `Frequência: ${frequency} (${((frequency / lastDraws.length) * 100).toFixed(1)}%)\n`;
        tooltip += PRIME_NUMBERS.includes(number) ? 'Número primo\n' : '';
        tooltip += EXTREME_NUMBERS.includes(number) ? 'Número extremo\n' : '';
        tooltip += lastDraw ? `Último sorteio: ${lastDraw.date}` : 'Nunca sorteado';
        
        return tooltip;
    }
    
    // Alterna seleção de um número
    function toggleSelection(number) {
        const index = selectedNumbers.indexOf(number);
        if (index > -1) {
            selectedNumbers.splice(index, 1);
        } else {
            if (selectedNumbers.length < GAME_SIZE) {
                selectedNumbers.push(number);
            } else {
                alert(`Limite máximo de ${GAME_SIZE} números atingido!`);
            }
        }
        renderNumberCards();
        updateSelectionCount();
    }
    
    // Atualiza contador de seleção
    function updateSelectionCount() {
        document.getElementById('selected-count').textContent = selectedNumbers.length;
        const progress = (selectedNumbers.length / GAME_SIZE) * 100;
        document.getElementById('selection-progress').style.width = `${progress}%`;
    }
    
    // Limpa seleção
    function clearSelection() {
        selectedNumbers = [];
        renderNumberCards();
        updateSelectionCount();
    }
    
    // Seleciona números quentes
    function selectHotNumbers() {
        const avgFrequency = lastDraws.length * GAME_SIZE / MAX_NUMBERS;
        const hotNumbers = frequencyData
            .map((freq, index) => ({number: index + 1, freq}))
            .filter(item => item.freq >= avgFrequency * 1.5)
            .sort((a, b) => b.freq - a.freq)
            .map(item => item.number);
        
        selectNumbers(hotNumbers.slice(0, GAME_SIZE));
    }
    
    // Seleciona números frios
    function selectColdNumbers() {
        const avgFrequency = lastDraws.length * GAME_SIZE / MAX_NUMBERS;
        const coldNumbers = frequencyData
            .map((freq, index) => ({number: index + 1, freq}))
            .filter(item => item.freq <= avgFrequency * 0.5)
            .sort((a, b) => a.freq - b.freq)
            .map(item => item.number);
        
        selectNumbers(coldNumbers.slice(0, GAME_SIZE));
    }
    
    // Seleciona números primos
    function selectPrimeNumbers() {
        selectNumbers(PRIME_NUMBERS.slice(0, GAME_SIZE));
    }
    
    // Seleciona um conjunto de números
    function selectNumbers(numbers) {
        selectedNumbers = numbers.slice(0, GAME_SIZE);
        renderNumberCards();
        updateSelectionCount();
    }
    
    // Gera um jogo aleatório
    function generateRandomGame() {
        const numbers = [];
        while (numbers.length < GAME_SIZE) {
            const num = Math.floor(Math.random() * MAX_NUMBERS) + 1;
            if (!numbers.includes(num)) numbers.push(num);
        }
        return numbers.sort((a, b) => a - b);
    }
    
    // Gera jogos aleatórios
    function generateRandomGames(count = 5) {
        const games = [];
        for (let i = 0; i < count && generatedGames.length < MAX_GAMES; i++) {
            const game = generateRandomGame();
            games.push(game);
            generatedGames.push(game);
        }
        renderGeneratedGames();
    }
    
    // Gera jogos inteligentes
    function generateSmartGames(count = 5) {
        const games = [];
        
        while (games.length < count && generatedGames.length + games.length < MAX_GAMES) {
            let game;
            let attempts = 0;
            const maxAttempts = 100;
            
            do {
                game = generateSmartGame();
                attempts++;
            } while (attempts < maxAttempts && (isRepeated(game) || !isValidGame(game)));
            
            if (game && isValidGame(game)) {
                games.push(game);
            }
        }
        
        generatedGames = [...generatedGames, ...games];
        renderGeneratedGames();
    }
    
    // Gera um jogo inteligente
    function generateSmartGame() {
        // Ponderar números baseado na frequência (mais chance para médios)
        const weightedNumbers = frequencyData.map((freq, index) => {
            const number = index + 1;
            let weight = 1;
            
            // Ajustar pesos baseado em estratégias
            if (frequencyData[index] === 0) weight = 3; // Nunca sorteados
            else if (frequencyData[index] < Math.max(...frequencyData) * 0.3) weight = 2; // Frios
            else if (frequencyData[index] > Math.max(...frequencyData) * 0.7) weight = 0.5; // Quentes
            
            return { number, weight };
        });
        
        // Ordenar por peso
        weightedNumbers.sort((a, b) => b.weight - a.weight);
        
        // Selecionar números ponderados
        const game = [];
        while (game.length < GAME_SIZE) {
            const totalWeight = weightedNumbers.reduce((sum, item) => sum + item.weight, 0);
            let random = Math.random() * totalWeight;
            let sum = 0;
            
            for (const item of weightedNumbers) {
                sum += item.weight;
                if (random <= sum && !game.includes(item.number)) {
                    game.push(item.number);
                    break;
                }
            }
        }
        
        return game.sort((a, b) => a - b);
    }
    
    // Gera jogos a partir da seleção atual
    function generateFromSelection() {
        if (selectedNumbers.length < GAME_SIZE) {
            alert(`Selecione pelo menos ${GAME_SIZE} números primeiro!`);
            return;
        }
        
        const game = [...selectedNumbers].sort((a, b) => a - b);
        generatedGames.push(game);
        renderGeneratedGames();
    }
    
    // Verifica se um jogo é válido
    function isValidGame(numbers) {
        return (
            numbers.length === GAME_SIZE &&
            new Set(numbers).size === GAME_SIZE &&
            isBalanced(numbers) &&
            hasPrimes(numbers) &&
            hasExtremes(numbers) &&
            hasDecadeCoverage(numbers)
        );
    }
    
    // Verifica balanceamento par/ímpar
    function isBalanced(numbers) {
        const evens = numbers.filter(n => n % 2 === 0).length;
        return evens >= 5 && evens <= 10; // 5-10 pares
    }
    
    // Verifica presença de números primos
    function hasPrimes(numbers) {
        const primes = numbers.filter(n => PRIME_NUMBERS.includes(n)).length;
        return primes >= 2 && primes <= 6; // 2-6 primos
    }
    
    // Verifica presença de números extremos
    function hasExtremes(numbers) {
        const extremes = numbers.filter(n => EXTREME_NUMBERS.includes(n)).length;
        return extremes >= 1 && extremes <= 4; // 1-4 extremos
    }
    
    // Verifica cobertura por dezenas
    function hasDecadeCoverage(numbers) {
        const decades = new Set(numbers.map(n => Math.floor((n - 1) / 10)));
        return decades.size >= 2; // Pelo menos 2 dezenas diferentes
    }
    
    // Verifica se combinação já foi sorteada
    function isRepeated(numbers) {
        return lastDraws.some(draw => arraysEqual(numbers, draw.numbers)) ||
               generatedGames.some(game => arraysEqual(numbers, game));
    }
    
    // Compara arrays
    function arraysEqual(a, b) {
        return a.length === b.length && a.every((v, i) => v === b[i]);
    }
    
    // Renderiza jogos gerados
    function renderGeneratedGames() {
        const container = document.getElementById('generated-games');
        container.innerHTML = '';
        
        if (generatedGames.length === 0) {
            container.innerHTML = '<p>Nenhum jogo gerado ainda. Clique em "Gerar Jogos" para começar.</p>';
            return;
        }
        
        generatedGames.forEach((game, index) => {
            const div = document.createElement('div');
            div.className = 'game-report';
            div.innerHTML = `
                <h3 class="game-title">Jogo ${index + 1} <span class="badge ${getGameQualityClass(game)}">${getGameQuality(game)}</span></h3>
                <div class="game-numbers">${renderNumbers(game)}</div>
                <div class="game-stats">${renderGameStats(game)}</div>
                <button class="danger" onclick="removeGame(${index})">Remover</button>
            `;
            container.appendChild(div);
        });
    }
    
    // Remove um jogo gerado
    function removeGame(index) {
        generatedGames.splice(index, 1);
        renderGeneratedGames();
    }
    
    // Limpa todos os jogos gerados
    function clearGames() {
        generatedGames = [];
        renderGeneratedGames();
    }
    
    // Salva jogos no localStorage
    function saveGames() {
        localStorage.setItem('lotofacilGames', JSON.stringify(generatedGames));
        alert('Jogos salvos com sucesso!');
    }
    
    // Carrega jogos do localStorage
    function loadSavedGames() {
        const savedGames = localStorage.getItem('lotofacilGames');
        if (savedGames) {
            generatedGames = JSON.parse(savedGames);
            renderGeneratedGames();
            alert(`${generatedGames.length} jogos carregados!`);
        } else {
            alert('Nenhum jogo salvo encontrado!');
        }
    }
    
    // Retorna a qualidade do jogo (baseado em critérios)
    function getGameQuality(game) {
        const score = calculateGameScore(game);
        
        if (score >= 8) return 'Excelente';
        if (score >= 6) return 'Bom';
        if (score >= 4) return 'Regular';
        return 'Ruim';
    }
    
    // Retorna classe CSS para qualidade do jogo
    function getGameQualityClass(game) {
        const score = calculateGameScore(game);
        
        if (score >= 8) return 'success';
        if (score >= 6) return 'primary';
        if (score >= 4) return 'warning';
        return 'danger';
    }
    
    // Calcula pontuação do jogo
    function calculateGameScore(game) {
        let score = 0;
        
        // Balanceamento par/ímpar
        const evens = game.filter(n => n % 2 === 0).length;
        if (evens >= 6 && evens <= 9) score += 3;
        else if (evens >= 5 && evens <= 10) score += 1;
        
        // Números primos
        const primes = game.filter(n => PRIME_NUMBERS.includes(n)).length;
        if (primes >= 3 && primes <= 5) score += 3;
        else if (primes >= 2 && primes <= 6) score += 1;
        
        // Números extremos
        const extremes = game.filter(n => EXTREME_NUMBERS.includes(n)).length;
        if (extremes >= 2 && extremes <= 3) score += 2;
        else if (extremes >= 1 && extremes <= 4) score += 1;
        
        // Cobertura de dezenas
        const decades = new Set(game.map(n => Math.floor((n - 1) / 10))).size;
        if (decades >= 3) score += 2;
        else if (decades >= 2) score += 1;
        
        // Distribuição de frequência
        const freqScore = game.reduce((sum, num) => sum + (frequencyData[num - 1] || 0), 0);
        const avgFreq = lastDraws.length * GAME_SIZE / MAX_NUMBERS;
        const expectedFreq = avgFreq * GAME_SIZE;
        
        if (Math.abs(freqScore - expectedFreq) <= expectedFreq * 0.2) score += 2;
        else if (Math.abs(freqScore - expectedFreq) <= expectedFreq * 0.4) score += 1;
        
        return score;
    }
    
    // Renderiza números do jogo
    function renderNumbers(numbers) {
        return numbers.map(n => 
            `<span class="number-ball ${getNumberClass(n)}" title="${getNumberTooltip(n)}">${n}</span>`
        ).join(' ');
    }
    
    // Renderiza estatísticas do jogo
    function renderGameStats(game) {
        const evens = game.filter(n => n % 2 === 0).length;
        const primes = game.filter(n => PRIME_NUMBERS.includes(n)).length;
        const extremes = game.filter(n => EXTREME_NUMBERS.includes(n)).length;
        const decades = new Set(game.map(n => Math.floor((n - 1) / 10))).size;
        const sum = game.reduce((a, b) => a + b, 0);
        const avg = sum / GAME_SIZE;
        
        return `
            <div class="game-stat">
                <p><strong>Pares/Ímpares:</strong> ${evens} pares / ${GAME_SIZE - evens} ímpares</p>
                <p><strong>Números primos:</strong> ${primes}</p>
                <p><strong>Números extremos:</strong> ${extremes}</p>
                <p><strong>Dezenas:</strong> ${decades} diferentes</p>
                <p><strong>Soma total:</strong> ${sum} (média ${avg.toFixed(1)})</p>
            </div>
        `;
    }
    
    // Renderiza tabela de estatísticas
    function renderStatistics() {
        const table = document.getElementById('stat-table');
        table.innerHTML = `
            <tr>
                <th>Número</th>
                <th>Frequência</th>
                <th>% de Sorteios</th>
                <th>Último Sorteio</th>
                <th>Dias desde último</th>
            </tr>
        `;
        
        const today = new Date();
        
        for (let i = 1; i <= MAX_NUMBERS; i++) {
            const lastDraw = lastDraws.slice().reverse().find(draw => draw.numbers.includes(i));
            const lastDrawDate = lastDraw ? new Date(lastDraw.date.split('/').reverse().join('-')) : null;
            const daysSince = lastDrawDate ? Math.floor((today - lastDrawDate) / (1000 * 60 * 60 * 24)) : 'Nunca';
            
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${i}</td>
                <td>${frequencyData[i-1]}</td>
                <td>${((frequencyData[i-1] / lastDraws.length) * 100).toFixed(1)}%</td>
                <td>${lastDraw ? lastDraw.date : '-'}</td>
                <td>${daysSince}</td>
            `;
            table.appendChild(row);
        }
    }
    
    // Atualiza todos os gráficos
    function updateCharts() {
        createFrequencyChart();
        createTrendChart();
        createHeatmapChart();
        createParityChart();
        createDecadesChart();
        createLinesChart();
    }
    
    // Cria gráfico de frequência
    function createFrequencyChart() {
        const ctx = document.getElementById('frequency-chart').getContext('2d');
        
        if (charts.frequency) charts.frequency.destroy();
        
        charts.frequency = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Array.from({length: MAX_NUMBERS}, (_, i) => i + 1),
                datasets: [{
                    label: 'Frequência de sorteio',
                    data: frequencyData,
                    backgroundColor: Array.from({length: MAX_NUMBERS}, (_, i) => 
                        getNumberColor(i + 1, 0.7)
                    ),
                    borderColor: Array.from({length: MAX_NUMBERS}, (_, i) => 
                        getNumberColor(i + 1, 1)
                    ),
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Número de sorteios'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Números'
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const num = context.dataIndex + 1;
                                const freq = context.raw;
                                const percentage = (freq / lastDraws.length * 100).toFixed(1);
                                return `Número ${num}: ${freq} vezes (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Cria gráfico de tendência
    function createTrendChart() {
        const ctx = document.getElementById('trend-chart').getContext('2d');
        
        // Agrupa dados por período (últimos 5, 10, 15, 20, 25, 30 sorteios)
        const periodData = [5, 10, 15, 20, 25, 30]
            .filter(p => p <= lastDraws.length)
            .map(p => {
                const periodDraws = lastDraws.slice(-p);
                const periodFreq = Array(MAX_NUMBERS).fill(0);
                
                periodDraws.forEach(draw => {
                    draw.numbers.forEach(num => periodFreq[num - 1]++);
                });
                
                return periodFreq.map(f => (f / p) * 100);
            });
        
        if (charts.trend) charts.trend.destroy();
        
        charts.trend = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array.from({length: MAX_NUMBERS}, (_, i) => i + 1),
                datasets: periodData.map((data, i) => ({
                    label: `Últimos ${[5, 10, 15, 20, 25, 30][i]} sorteios`,
                    data: data,
                    borderColor: `hsl(${i * 60}, 70%, 50%)`,
                    backgroundColor: `hsla(${i * 60}, 70%, 50%, 0.1)`,
                    tension: 0.3,
                    fill: false
                }))
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Frequência (%)'
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Números'
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.dataset.label}: ${context.raw.toFixed(1)}%`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Cria heatmap de frequência
    function createHeatmapChart() {
        const ctx = document.getElementById('heatmap-chart').getContext('2d');
        
        // Prepara dados para o heatmap (frequência por número por período)
        const heatmapData = [];
        const periods = Math.min(6, Math.ceil(lastDraws.length / 5));
        
        for (let i = 0; i < periods; i++) {
            const start = Math.floor(i * lastDraws.length / periods);
            const end = Math.floor((i + 1) * lastDraws.length / periods);
            const periodDraws = lastDraws.slice(start, end);
            
            const periodFreq = Array(MAX_NUMBERS).fill(0);
            periodDraws.forEach(draw => {
                draw.numbers.forEach(num => periodFreq[num - 1]++);
            });
            
            heatmapData.push(periodFreq.map(f => (f / periodDraws.length) * 100));
        }
        
        if (charts.heatmap) charts.heatmap.destroy();
        
        charts.heatmap = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: Array.from({length: periods}, (_, i) => 
                    `Sorteios ${i * 5 + 1}-${Math.min((i + 1) * 5, lastDraws.length)}`
                ),
                datasets: Array.from({length: MAX_NUMBERS}, (_, num) => ({
                    label: `Número ${num + 1}`,
                    data: heatmapData.map(period => period[num]),
                    backgroundColor: getNumberColor(num + 1, 0.7),
                    borderColor: getNumberColor(num + 1, 1),
                    borderWidth: 1
                }))
            },
            options: {
                responsive: true,
                scales: {
                    x: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Período'
                        }
                    },
                    y: {
                        stacked: true,
                        title: {
                            display: true,
                            text: 'Frequência (%)'
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `Número ${context.datasetIndex + 1}: ${context.raw.toFixed(1)}%`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Cria gráfico de paridade
    function createParityChart() {
        const ctx = document.getElementById('parity-chart').getContext('2d');
        
        // Calcula distribuição de pares/ímpares nos sorteios
        const parityData = lastDraws.map(draw => {
            return {
                even: draw.numbers.filter(n => n % 2 === 0).length,
                odd: draw.numbers.filter(n => n % 2 !== 0).length
            };
        });
        
        const evenAvg = parityData.reduce((sum, item) => sum + item.even, 0) / parityData.length;
        const oddAvg = parityData.reduce((sum, item) => sum + item.odd, 0) / parityData.length;
        
        if (charts.parity) charts.parity.destroy();
        
        charts.parity = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Pares', 'Ímpares'],
                datasets: [{
                    data: [evenAvg, oddAvg],
                    backgroundColor: [
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 99, 132, 0.7)'
                    ],
                    borderColor: [
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 99, 132, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw.toFixed(1)} por jogo`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Cria gráfico de distribuição por dezenas
    function createDecadesChart() {
        const ctx = document.getElementById('decades-chart').getContext('2d');
        
        // Calcula distribuição por dezenas (1-10, 11-20, 21-25)
        const decadesData = [0, 0, 0];
        
        lastDraws.forEach(draw => {
            draw.numbers.forEach(num => {
                if (num <= 10) decadesData[0]++;
                else if (num <= 20) decadesData[1]++;
                else decadesData[2]++;
            });
        });
        
        // Normaliza pela quantidade de sorteios
        const normalized = decadesData.map(count => count / lastDraws.length);
        
        if (charts.decades) charts.decades.destroy();
        
        charts.decades = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['1-10', '11-20', '21-25'],
                datasets: [{
                    label: 'Números por dezena',
                    data: normalized,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.7)',
                        'rgba(54, 162, 235, 0.7)',
                        'rgba(255, 206, 86, 0.7)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Média por sorteio'
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw.toFixed(1)} números`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Cria gráfico de distribuição por linhas (1-5, 6-10, etc.)
    function createLinesChart() {
        const ctx = document.getElementById('lines-chart').getContext('2d');
        
        // Calcula distribuição por linhas (5 números cada)
        const lines = Math.ceil(MAX_NUMBERS / 5);
        const linesData = Array(lines).fill(0);
        
        lastDraws.forEach(draw => {
            draw.numbers.forEach(num => {
                const line = Math.floor((num - 1) / 5);
                linesData[line]++;
            });
        });
        
        // Normaliza pela quantidade de sorteios
        const normalized = linesData.map(count => count / lastDraws.length);
        
        if (charts.lines) charts.lines.destroy();
        
        charts.lines = new Chart(ctx, {
            type: 'radar',
            data: {
                labels: Array.from({length: lines}, (_, i) => 
                    `${i * 5 + 1}-${Math.min((i + 1) * 5, MAX_NUMBERS)}`
                ),
                datasets: [{
                    label: 'Números por linha',
                    data: normalized,
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    pointBackgroundColor: 'rgba(75, 192, 192, 1)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(75, 192, 192, 1)'
                }]
            },
            options: {
                responsive: true,
                scales: {
                    r: {
                        angleLines: {
                            display: true
                        },
                        suggestedMin: 0
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw.toFixed(1)} números`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    // Retorna cor para um número baseado em suas propriedades
    function getNumberColor(number, opacity = 1) {
        if (PRIME_NUMBERS.includes(number)) return `rgba(46, 204, 113, ${opacity})`;
        if (EXTREME_NUMBERS.includes(number)) return `rgba(241, 196, 15, ${opacity})`;
        
        const index = number - 1;
        const frequency = frequencyData[index];
        const avgFrequency = lastDraws.length * GAME_SIZE / MAX_NUMBERS;
        
        if (frequency >= avgFrequency * 1.5) return `rgba(231, 76, 60, ${opacity})`;
        if (frequency <= avgFrequency * 0.5) return `rgba(52, 152, 219, ${opacity})`;
        return `rgba(149, 165, 166, ${opacity})`;
    }
    
    // Alterna entre abas
    function switchTab(tabName) {
        // Esconde todos os conteúdos de abas
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });
        
        // Remove classe active de todas as abas
        document.querySelectorAll('.tab').forEach(tab => {
            tab.classList.remove('active');
        });
        
        // Mostra o conteúdo da aba selecionada
        document.getElementById(`${tabName}-tab`).classList.add('active');
        
        // Adiciona classe active na aba selecionada
        document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
        
        // Atualiza gráficos quando a aba é alternada
        if (tabName === 'frequency') createHeatmapChart();
        if (tabName === 'patterns') {
            createParityChart();
            createDecadesChart();
            createLinesChart();
        }
    }
</script>
</body>
</html>
