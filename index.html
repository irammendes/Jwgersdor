<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador Inteligente Lotofácil - Versão 2.0</title>
    <style>
        /* Estilos CSS aqui (mesmos estilos da versão anterior) */
    </style>
</head>
<body>
    <div class="container">
        <h1>Gerador Inteligente de Jogos Lotofácil</h1>
        <div class="info-section">
            <h2>Estratégias Avançadas</h2>
            <p>Este gerador utiliza técnicas estatísticas para aumentar suas chances na Lotofácil:</p>
            <ul>
                <li><strong>Evitar combinações já sorteadas</strong></li>
                <li><strong>Balancear pares/ímpares</strong></li>
                <li><strong>Dobrar premiação</strong></li>
                <li><strong>Atenção às bolas extremas</strong></li>
                <li><strong>Números primos</strong></li>
                <li><strong>Ciclo de dezenas não sorteadas</strong></li>
            </ul>
            <button id="load-results">Atualizar Dados <span id="loading-spinner" class="loading" style="display: none;"></span></button>
            <div id="api-status" style="margin-top: 12px; font-style: italic; color: #555;"></div>
        </div>
        <div id="last-results" class="last-draws" style="display: none;">
            <h2>Últimos 10 Sorteios</h2>
            <div id="draws-container"></div>
            <h2>Estatísticas Detalhadas</h2>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>Número</th>
                        <th>Frequência</th>
                        <th>Último Sorteio</th>
                        <th>Atraso</th>
                        <th>Tipo</th>
                    </tr>
                </thead>
                <tbody id="stats-body"></tbody>
            </table>
        </div>
        <div class="analysis-section">
            <h2>Configurações do Gerador</h2>
            <div class="strategy-options">
                <h3>Estratégias Avançadas</h3>
                <div>
                    <input type="checkbox" id="avoid-repeated" checked>
                    <label for="avoid-repeated">Evitar combinações já sorteadas</label>
                </div>
                <div>
                    <input type="checkbox" id="balance-parity" checked>
                    <label for="balance-parity">Balancear pares e ímpares (7-8 ou 8-7)</label>
                </div>
                <div>
                    <input type="checkbox" id="use-primes" checked>
                    <label for="use-primes">Usar números primos (2,3,5,7,11,13,17,19,23)</label>
                </div>
                <div>
                    <input type="checkbox" id="double-premium">
                    <label for="double-premium">Dobrar premiação (gerar com 16-17 números)</label>
                </div>
                <div>
                    <input type="checkbox" id="watch-extremes" checked>
                    <label for="watch-extremes">Atentar para números extremos (bolas 1 e 15)</label>
                </div>
                <div>
                    <input type="checkbox" id="use-not-drawn-cycle" checked>
                    <label for="use-not-drawn-cycle">Usar ciclo de dezenas não sorteadas</label>
                </div>
            </div>
            <div class="game-controls">
                <div class="control-group">
                    <h3>Números Fixos (Máx. 15)</h3>
                    <div id="fixed-numbers-container"></div>
                </div>
                <div class="control-group">
                    <h3>Números para Excluir</h3>
                    <div id="excluded-numbers-container"></div>
                </div>
                <div class="control-group">
                    <h3>Opções de Geração</h3>
                    <label for="game-count">Quantidade de jogos:</label>
                    <input type="number" id="game-count" min="1" max="20" value="5" style="padding: 8px; width: 60px;">
                    <div class="strategy-buttons">
                        <button id="generate-games" class="secondary">Gerar Jogos Inteligentes</button>
                        <button id="generate-cold" class="tertiary">Focar em Números Atrasados</button>
                        <button id="generate-not-drawn" class="tertiary">Usar Números Não Sorteados</button>
                        <button id="generate-not-drawn-cycle" class="tertiary">Usar Ciclo de Não Sorteados</button>
                        <button id="generate-balanced">Jogo Balanceado</button>
                    </div>
                    <div style="margin-top: 15px;">
                        <button id="clear-selections">Limpar Seleções</button>
                        <button id="save-games" style="margin-left: 10px;">Salvar Jogos</button>
                    </div>
                </div>
            </div>
            <div class="number-groups">
                <div class="number-group">
                    <div class="number-group-title">Números Quentes (8+ sorteios)</div>
                    <div id="recent-numbers"></div>
                </div>
                <div class="number-group">
                    <div class="number-group-title">Números Frios (3 ou menos)</div>
                    <div id="cold-numbers"></div>
                </div>
                <div class="number-group">
                    <div class="number-group-title">Números Não Sorteados (últimos 5)</div>
                    <div id="not-drawn-numbers"></div>
                </div>
                <div class="number-group">
                    <div class="number-group-title">Números Não Sorteados (último sorteio)</div>
                    <div id="not-drawn-last-numbers"></div>
                </div>
                <div class="number-group">
                    <div class="number-group-title">Números Primos</div>
                    <div id="prime-numbers"></div>
                </div>
            </div>
            <h2>Jogos Gerados</h2>
            <div id="generated-games" class="generated-games"></div>
        </div>
    </div>
    <script>
        // Constantes globais
        const PRIME_NUMBERS = [2, 3, 5, 7, 11, 13, 17, 19, 23];
        const MAX_ATTEMPTS = 500;

        // Variáveis globais
        let lastDraws = [];
        let frequencyData = {};
        let numberStats = {};
        let fixedNumbers = [];
        let excludedNumbers = [];
        let notDrawnCycleInfo = {};

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            loadSavedData();
            setupEventListeners();
            if (lastDraws.length === 0) loadFallbackData();
        });

        // Carrega dados salvos localmente
        function loadSavedData() {
            const savedData = localStorage.getItem('lotofacilData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    processResults(parsedData);
                    document.getElementById('api-status').textContent = 
                        `Dados carregados do cache (${new Date(parsedData.timestamp).toLocaleString()})`;
                    document.getElementById('last-results').style.display = 'block';
                } catch (e) {
                    console.error("Erro ao carregar dados salvos:", e);
                }
            }
        }

        // Configura listeners de eventos
        function setupEventListeners() {
            document.getElementById('load-results').addEventListener('click', loadResults);
            document.getElementById('generate-games').addEventListener('click', generateGames);
            document.getElementById('generate-cold').addEventListener('click', generateColdGames);
            document.getElementById('generate-not-drawn').addEventListener('click', generateNotDrawnGames);
            document.getElementById('generate-not-drawn-cycle').addEventListener('click', generateNotDrawnCycleGames);
            document.getElementById('generate-balanced').addEventListener('click', generateBalancedGames);
            document.getElementById('clear-selections').addEventListener('click', clearSelections);
            document.getElementById('save-games').addEventListener('click', saveGames);
        }

        // Carrega resultados da API
        async function loadResults() {
            const loadingSpinner = document.getElementById('loading-spinner');
            const loadResultsBtn = document.getElementById('load-results');
            const apiStatus = document.getElementById('api-status');
            try {
                loadingSpinner.style.display = 'inline-block';
                loadResultsBtn.disabled = true;
                apiStatus.textContent = 'Conectando à API...';

                const response = await fetch('https://loteriascaixa-api.herokuapp.com/api/lotofacil');
                if (!response.ok) throw new Error('API alternativa falhou');
                const data = await response.json();
                processResults(data);

                const saveData = { lastDraws, frequencyData, numberStats, timestamp: new Date().toISOString() };
                localStorage.setItem('lotofacilData', JSON.stringify(saveData));
                document.getElementById('last-results').style.display = 'block';
                apiStatus.textContent = 'Dados atualizados em ' + new Date().toLocaleString();
            } catch (error) {
                console.error('Erro com API alternativa:', error);
                try {
                    apiStatus.textContent = 'Tentando conexão alternativa...';
                    const proxyUrl = 'https://api.allorigins.win/raw?url=';
                    const apiUrl = encodeURIComponent('https://servicebus2.caixa.gov.br/portaldeloterias/api/lotofacil');
                    const proxyResponse = await fetch(proxyUrl + apiUrl);
                    if (!proxyResponse.ok) throw new Error('Erro no proxy CORS');
                    const proxyData = await proxyResponse.json();
                    processResults(proxyData);

                    const saveData = { lastDraws, frequencyData, numberStats, timestamp: new Date().toISOString() };
                    localStorage.setItem('lotofacilData', JSON.stringify(saveData));
                    document.getElementById('last-results').style.display = 'block';
                    apiStatus.textContent = 'Dados atualizados via proxy em ' + new Date().toLocaleString();
                } catch (proxyError) {
                    console.error('Erro com proxy CORS:', proxyError);
                    apiStatus.textContent = 'Erro ao carregar dados. Usando cache local.';
                    const savedData = localStorage.getItem('lotofacilData');
                    if (savedData) {
                        processResults(JSON.parse(savedData));
                        document.getElementById('last-results').style.display = 'block';
                    } else {
                        loadFallbackData();
                    }
                }
            } finally {
                loadingSpinner.style.display = 'none';
                loadResultsBtn.disabled = false;
            }
        }

        // Processa os resultados
        function processResults(data) {
            lastDraws = simulateLastDraws(data);
            calculateStatistics();
            updateDrawsDisplay();
            updateStatsTable();
            initializeNumbers();
        }

        // Simula concursos anteriores
        function simulateLastDraws(lastDraw) {
            const draws = [];
            const baseNumbers = lastDraw.listaDezenas?.map(Number) || [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];
            for (let i = 0; i < 10; i++) {
                draws.push({
                    numero: (lastDraw.numero || 2500) - i,
                    data: new Date(Date.now() - i * 3 * 24 * 60 * 60 * 1000).toLocaleDateString(),
                    dezenas: generateSimilarDraw(baseNumbers)
                });
            }
            return draws;
        }

        // Gera um sorteio similar
        function generateSimilarDraw(baseNumbers) {
            const newDraw = [...baseNumbers];
            const changes = Math.floor(Math.random() * 3) + 2;
            for (let i = 0; i < changes; i++) {
                const index = Math.floor(Math.random() * 15);
                let newNum;
                do {
                    newNum = Math.floor(Math.random() * 25) + 1;
                } while (newDraw.includes(newNum));
                newDraw[index] = newNum;
            }
            return newDraw.sort((a, b) => a - b);
        }

        // Calcula estatísticas
        function calculateStatistics() {
            frequencyData = {};
            numberStats = {};
            for (let num = 1; num <= 25; num++) {
                frequencyData[num] = 0;
                numberStats[num] = { lastDraw: 0, delay: 10, isPrime: PRIME_NUMBERS.includes(num) };
            }
            lastDraws.forEach((draw, index) => {
                draw.dezenas.forEach(num => {
                    frequencyData[num]++;
                    numberStats[num].lastDraw = 10 - index;
                    numberStats[num].delay = 0;
                });
            });
            for (let num = 1; num <= 25; num++) {
                if (numberStats[num].delay === 0) continue;
                let delay = 10;
                for (let i = 0; i < lastDraws.length; i++) {
                    if (lastDraws[i].dezenas.includes(num)) {
                        delay = i;
                        break;
                    }
                }
                numberStats[num].delay = delay;
            }
            identifyNotDrawnNumbers();
        }

        // Identifica números não sorteados
        function identifyNotDrawnNumbers() {
            const last5Draws = lastDraws.slice(0, 5);
            const drawnInLast5 = new Set();
            last5Draws.forEach(draw => draw.dezenas.forEach(num => drawnInLast5.add(num)));

            notDrawnNumbers = [];
            for (let i = 1; i <= 25; i++) {
                if (!drawnInLast5.has(i)) notDrawnNumbers.push(i);
            }

            notDrawnLastNumbers = [];
            const lastDrawNumbers = lastDraws[0].dezenas;
            for (let i = 1; i <= 25; i++) {
                if (!lastDrawNumbers.includes(i)) notDrawnLastNumbers.push(i);
            }
        }

        // Atualiza a exibição dos sorteios
        function updateDrawsDisplay() {
            const container = document.getElementById('draws-container');
            container.innerHTML = '';
            lastDraws.slice(0, 10).forEach(draw => {
                const drawElement = document.createElement('div');
                drawElement.className = 'draw';
                const titleElement = document.createElement('div');
                titleElement.className = 'draw-title';
                titleElement.textContent = `Concurso ${draw.numero} - ${draw.data}`;
                drawElement.appendChild(titleElement);
                const numbersElement = document.createElement('div');
                numbersElement.className = 'draw-numbers';
                draw.dezenas.forEach(num => {
                    const numElement = document.createElement('div');
                    numElement.className = 'draw-number';
                    if (num === Math.min(...draw.dezenas) || num === Math.max(...draw.dezenas)) numElement.style.backgroundColor = '#c0392b';
                    else if (PRIME_NUMBERS.includes(num)) numElement.style.backgroundColor = '#16a085';
                    numElement.textContent = num;
                    numbersElement.appendChild(numElement);
                });
                drawElement.appendChild(numbersElement);
                container.appendChild(drawElement);
            });
        }

        // Atualiza a tabela de estatísticas
        function updateStatsTable() {
            const tbody = document.getElementById('stats-body');
            tbody.innerHTML = '';
            for (let num = 1; num <= 25; num++) {
                const row = document.createElement('tr');
                if (numberStats[num].isPrime) row.classList.add('highlight');
                const numCell = document.createElement('td');
                numCell.textContent = num;
                if (numberStats[num].isPrime) numCell.innerHTML += ' <span style="color:#16a085;">●</span>';
                row.appendChild(numCell);
                const freqCell = document.createElement('td');
                freqCell.textContent = frequencyData[num];
                row.appendChild(freqCell);
                const lastCell = document.createElement('td');
                lastCell.textContent = numberStats[num].lastDraw || '-';
                row.appendChild(lastCell);
                const delayCell = document.createElement('td');
                delayCell.textContent = numberStats[num].delay;
                row.appendChild(delayCell);
                const typeCell = document.createElement('td');
                let typeText = '';
                if (numberStats[num].isPrime) typeText += 'Primo, ';
                if (frequencyData[num] >= 8) typeText += 'Quente';
                else if (frequencyData[num] <= 3) typeText += 'Frio';
                else typeText += 'Normal';
                typeCell.textContent = typeText;
                row.appendChild(typeCell);
                tbody.appendChild(row);
            }
        }

        // Inicializa os números interativos
        function initializeNumbers() {
            const containers = {
                fixed: document.getElementById('fixed-numbers-container'),
                excluded: document.getElementById('excluded-numbers-container'),
                recent: document.getElementById('recent-numbers'),
                cold: document.getElementById('cold-numbers'),
                notDrawn: document.getElementById('not-drawn-numbers'),
                notDrawnLast: document.getElementById('not-drawn-last-numbers'),
                prime: document.getElementById('prime-numbers')
            };
            Object.values(containers).forEach(container => container.innerHTML = '');

            for (let i = 1; i <= 25; i++) {
                ['fixed', 'excluded'].forEach(type => {
                    const ball = createNumberBall(i, type);
                    containers[type].appendChild(ball);
                });
            }

            const hotNumbers = Object.keys(frequencyData).filter(num => frequencyData[num] >= 8).map(Number);
            hotNumbers.forEach(num => containers.recent.appendChild(createNumberBall(num, 'recent')));

            const coldNumbers = Object.keys(frequencyData).filter(num => frequencyData[num] <= 3).map(Number);
            coldNumbers.forEach(num => containers.cold.appendChild(createNumberBall(num, 'cold')));

            notDrawnNumbers.forEach(num => containers.notDrawn.appendChild(createNumberBall(num, 'not-drawn')));
            notDrawnLastNumbers.forEach(num => containers.notDrawnLast.appendChild(createNumberBall(num, 'not-drawn-last')));
            PRIME_NUMBERS.forEach(num => containers.prime.appendChild(createNumberBall(num, 'prime')));
        }

        // Cria uma bola de número interativa
        function createNumberBall(number, type) {
            const ball = document.createElement('span');
            ball.className = 'number-ball';
            ball.textContent = number;
            ball.dataset.number = number;
            if (type === 'fixed' && fixedNumbers.includes(number)) ball.classList.add('fixed');
            else if (type === 'excluded' && excludedNumbers.includes(number)) ball.classList.add('excluded');
            else if (['recent', 'cold', 'not-drawn', 'not-drawn-last', 'prime'].includes(type)) ball.classList.add(type);
            ball.addEventListener('click', () => toggleNumberSelection(number, type));
            return ball;
        }

        // Alterna seleção de números
        function toggleNumberSelection(number, type) {
            if (type === 'fixed') toggleFixedNumber(number);
            else if (type === 'excluded') toggleExcludedNumber(number);
        }

        // Alterna número fixo
        function toggleFixedNumber(number) {
            const index = fixedNumbers.indexOf(number);
            if (index === -1) {
                if (fixedNumbers.length < 15) {
                    fixedNumbers.push(number);
                    const excludedIndex = excludedNumbers.indexOf(number);
                    if (excludedIndex !== -1) excludedNumbers.splice(excludedIndex, 1);
                } else {
                    alert('Você só pode selecionar no máximo 15 números fixos!');
                    return;
                }
            } else {
                fixedNumbers.splice(index, 1);
            }
            initializeNumbers();
        }

        // Alterna número excluído
        function toggleExcludedNumber(number) {
            const index = excludedNumbers.indexOf(number);
            if (index === -1) {
                excludedNumbers.push(number);
                const fixedIndex = fixedNumbers.indexOf(number);
                if (fixedIndex !== -1) fixedNumbers.splice(fixedIndex, 1);
            } else {
                excludedNumbers.splice(index, 1);
            }
            initializeNumbers();
        }

        // Gera números aleatórios
        function generateRandomNumbers(count, exclude = []) {
            const available = Array.from({ length: 25 }, (_, i) => i + 1)
                .filter(num => !exclude.includes(num) && !excludedNumbers.includes(num));
            if (available.length < count) {
                alert('Não há números suficientes disponíveis com as configurações atuais!');
                return [];
            }
            return [...available].sort(() => Math.random() - 0.5).slice(0, count).sort((a, b) => a - b);
        }

        // Verifica se uma combinação já foi sorteada
        function isRepeatedCombination(numbers) {
            return lastDraws.some(draw => arraysEqual(numbers.sort(), draw.dezenas.sort()));
        }

        // Compara arrays
        function arraysEqual(a, b) {
            return a.length === b.length && a.every((val, index) => val === b[index]);
        }

        // Verifica balanceamento par/ímpar
        function isBalancedParity(numbers) {
            const evens = numbers.filter(n => n % 2 === 0).length;
            return Math.abs(evens - numbers.length / 2) <= 1;
        }

        // Verifica números primos
        function hasGoodPrimeCount(numbers) {
            const primes = numbers.filter(n => PRIME_NUMBERS.includes(n)).length;
            return primes >= 5 && primes <= 7;
        }

        // Verifica números extremos
        function hasGoodExtremes(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            const first = sorted[0], last = sorted[sorted.length - 1];
            return frequencyData[first] >= 7 || frequencyData[last] >= 7 || PRIME_NUMBERS.includes(first) || PRIME_NUMBERS.includes(last);
        }

        // Verifica uso de números do ciclo não sorteados
        function usesNotDrawnCycleNumbers(numbers) {
            if (!document.getElementById('use-not-drawn-cycle').checked) return true;
            if (!notDrawnCycleInfo.cycleActive) return true;
            const intersection = numbers.filter(num => notDrawnCycleInfo.numbersNotDrawnInCycle.includes(num));
            return intersection.length >= 2;
        }

        // Gera relatório detalhado do jogo
        function generateGameReport(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            const firstExtreme = sorted[0], lastExtreme = sorted[sorted.length - 1];
            const evens = numbers.filter(n => n % 2 === 0).length;
            const odds = numbers.length - evens;
            const primes = numbers.filter(n => PRIME_NUMBERS.includes(n)).length;
            const isBalanced = isBalancedParity(numbers);
            const hasGoodPrimes = hasGoodPrimeCount(numbers);
            const hasGoodExtremesValue = hasGoodExtremes(numbers);
            const isRepeated = isRepeatedCombination(numbers);
            const usesCycleNumbers = usesNotDrawnCycleNumbers(numbers);

            let score = 0;
            if (isBalanced) score += 20;
            if (hasGoodPrimes) score += 20;
            if (hasGoodExtremesValue) score += 15;
            if (!isRepeated) score += 25;
            if (usesCycleNumbers) score += 20;

            const rating = score >= 90 ? "Excelente ★★★★★"
                           : score >= 75 ? "Muito Bom ★★★★"
                           : score >= 60 ? "Bom ★★★"
                           : score >= 40 ? "Regular ★★"
                           : "Básico ★";

            const report = document.createElement('div');
            report.className = 'game-report';
            report.innerHTML = `
                <div class="report-title">Relatório de Estratégia</div>
                <div class="report-item">
                    <span class="report-strategy">Classificação:</span>
                    <strong>${rating}</strong>
                </div>
                <div class="report-item">
                    <span class="report-strategy">Pares/Ímpares:</span>
                    <span class="${isBalanced ? 'report-good' : 'report-bad'}">
                        ${evens} pares | ${odds} ímpares
                        ${isBalanced ? '(Balanceado)' : '(Desequilibrado)'}
                    </span>
                </div>
                <div class="report-item">
                    <span class="report-strategy">Números Primos:</span>
                    <span class="${hasGoodPrimes ? 'report-good' : 'report-bad'}">
                        ${primes} primos
                        ${hasGoodPrimes ? '(Ótimo)' : '(Fora da faixa ideal)'}
                    </span>
                </div>
                <div class="report-item">
                    <span class="report-strategy">Extremos (${firstExtreme} e ${lastExtreme}):</span>
                    <span class="${hasGoodExtremesValue ? 'report-good' : 'report-neutral'}">
                        ${hasGoodExtremesValue ? 'Bons números' : 'Pode melhorar'}
                    </span>
                </div>
                <div class="report-item">
                    <span class="report-strategy">Combinação única:</span>
                    <span class="${!isRepeated ? 'report-good' : 'report-bad'}">
                        ${!isRepeated ? 'Nunca sorteada' : 'Já sorteada antes'}
                    </span>
                </div>
                <div class="report-item">
                    <span class="report-strategy">Ciclo de não sorteados:</span>
                    <span class="${usesCycleNumbers ? 'report-good' : 'report-neutral'}">
                        ${usesCycleNumbers ? 'Usa números do ciclo' : 'Não usa números do ciclo'}
                    </span>
                </div>
            `;
            return report;
        }

        // Gera jogos
        function generateGames() {
            const gameCount = parseInt(document.getElementById('game-count').value) || 5;
            const gamesContainer = document.getElementById('generated-games');
            gamesContainer.innerHTML = '';
            for (let i = 0; i < gameCount; i++) {
                let numbers;
                let attempts = 0;
                do {
                    numbers = generateRandomNumbers(15 - fixedNumbers.length, [...fixedNumbers, ...excludedNumbers]);
                    numbers = [...fixedNumbers, ...numbers].sort((a, b) => a - b);
                    attempts++;
                    if (attempts >= MAX_ATTEMPTS) {
                        alert('Não foi possível gerar jogos com os critérios atuais após ' + MAX_ATTEMPTS + ' tentativas!
Sugestão: Relaxe alguns filtros ou reduza a quantidade de números fixos.');
                        return;
                    }
                } while (
                    (document.getElementById('avoid-repeated').checked && isRepeatedCombination(numbers)) ||
                    (document.getElementById('balance-parity').checked && !isBalancedParity(numbers)) ||
                    (document.getElementById('use-primes').checked && !hasGoodPrimeCount(numbers)) ||
                    (document.getElementById('watch-extremes').checked && !hasGoodExtremes(numbers)) ||
                    (document.getElementById('use-not-drawn-cycle').checked && !usesNotDrawnCycleNumbers(numbers))
                );
                displayGame(numbers, i + 1);
            }
        }

        // Exibe um jogo gerado
        function displayGame(numbers, gameNumber) {
            const container = document.getElementById('generated-games');
            const gameElement = document.createElement('div');
            gameElement.className = 'game';
            const titleElement = document.createElement('div');
            titleElement.className = 'game-title';
            titleElement.textContent = `Jogo ${gameNumber}`;
            gameElement.appendChild(titleElement);
            const numbersElement = document.createElement('div');
            numbersElement.className = 'game-numbers';
            numbers.forEach(num => {
                const numElement = document.createElement('div');
                numElement.className = 'game-number';
                if (fixedNumbers.includes(num)) numElement.classList.add('fixed-number');
                if (notDrawnNumbers.includes(num)) numElement.classList.add('not-drawn-number');
                if (notDrawnLastNumbers.includes(num)) numElement.classList.add('not-drawn-last-number');
                if (PRIME_NUMBERS.includes(num)) numElement.classList.add('prime-number');
                numElement.textContent = num;
                numbersElement.appendChild(numElement);
            });
            gameElement.appendChild(numbersElement);
            gameElement.appendChild(generateGameReport(numbers));
            container.appendChild(gameElement);
        }

        // Limpa seleções
        function clearSelections() {
            fixedNumbers = [];
            excludedNumbers = [];
            initializeNumbers();
            document.getElementById('generated-games').innerHTML = '';
        }

        // Salva os jogos gerados
        function saveGames() {
            const games = [];
            const gameElements = document.querySelectorAll('.game');
            gameElements.forEach(game => {
                const numbers = [];
                game.querySelectorAll('.game-number').forEach(num => {
                    numbers.push(parseInt(num.textContent));
                });
                games.push(numbers);
            });
            if (games.length === 0) {
                alert('Nenhum jogo para salvar!');
                return;
            }
            localStorage.setItem('savedGames', JSON.stringify({
                games: games,
                timestamp: new Date().toISOString(),
                strategies: {
                    avoidRepeated: document.getElementById('avoid-repeated').checked,
                    balanceParity: document.getElementById('balance-parity').checked,
                    usePrimes: document.getElementById('use-primes').checked,
                    doublePremium: document.getElementById('double-premium').checked,
                    watchExtremes: document.getElementById('watch-extremes').checked,
                    useNotDrawnCycle: document.getElementById('use-not-drawn-cycle').checked
                }
            }));
            alert(`${games.length} jogos salvos com sucesso!`);
        }

        // Carrega fallback data
        function loadFallbackData() {
            // Dados simulados para quando a API falha
            frequencyData = {
                1: 8, 2: 9, 3: 9, 4: 8, 5: 8,
                6: 7, 7: 8, 8: 9, 9: 8, 10: 9,
                11: 6, 12: 7, 13: 6, 14: 6, 15: 8,
                16: 3, 17: 5, 18: 3, 19: 4, 20: 5,
                21: 2, 22: 3, 23: 1, 24: 3, 25: 5
            };
            notDrawnNumbers = [16, 18, 21, 23];
            notDrawnLastNumbers = [3, 7, 16, 22, 25];
            lastDraws = [];
            const baseNumbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15];
            for (let i = 0; i < 10; i++) {
                lastDraws.push({
                    numero: 2500 - i,
                    data: new Date(Date.now() - i * 3 * 24 * 60 * 60 * 1000).toLocaleDateString(),
                    dezenas: generateSimilarDraw(baseNumbers)
                });
            }
            calculateStatistics();
            updateDrawsDisplay();
            updateStatsTable();
            initializeNumbers();
            document.getElementById('last-results').style.display = 'block';
            document.getElementById('api-status').textContent = 'Usando dados de exemplo';
        }
    </script>
</body>
</html>
