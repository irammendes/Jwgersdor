<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador Inteligente Lotofácil - Estratégia Combinada</title>
    <style>
        :root {
            --primary: #3498db;
            --danger: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --prime: #16a085;
            --extreme: #c0392b;
            --cold: #2980b9;
            --hot: #e74c3c;
            --not-drawn: #f39c12;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #34495e;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        h1, h2, h3, h4 {
            color: var(--dark);
            margin-top: 0;
        }
        h1 {
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--primary);
            margin-bottom: 25px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 4px solid var(--primary);
        }
        .chart-container {
            width: 100%;
            height: 400px;
            margin: 25px 0;
        }
        .number-ball {
            display: inline-block;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            text-align: center;
            line-height: 32px;
            margin: 3px;
            font-weight: bold;
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        .number-ball:hover {
            transform: scale(1.1);
        }
        .hot {
            background-color: var(--hot);
        }
        .cold {
            background-color: var(--cold);
        }
        .prime {
            background-color: var(--prime);
        }
        .extreme {
            background-color: var(--extreme);
        }
        .not-drawn {
            background-color: var(--not-drawn);
        }
        .fixed {
            background-color: #8e44ad;
        }
        .excluded {
            background-color: #7f8c8d;
            text-decoration: line-through;
        }
        .highlight {
            background-color: #fffacd;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .feature-card {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border-left: 3px solid var(--primary);
        }
        .error-message {
            color: var(--danger);
            background-color: #fdecea;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 5px solid var(--danger);
        }
        .loading {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
            font-size: 1.1em;
        }
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .recommendation-card {
            background-color: #e8f4fc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            text-align: center;
        }
        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }
        .game-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin: 25px 0;
        }
        .control-group {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .strategy-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        button {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 18px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        button.secondary {
            background-color: var(--success);
        }
        button.secondary:hover {
            background-color: #27ae60;
        }
        button.tertiary {
            background-color: var(--warning);
        }
        button.tertiary:hover {
            background-color: #e67e22;
        }
        .generated-games {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        .game {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .game-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--dark);
        }
        .game-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .game-number {
            display: inline-block;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            text-align: center;
            line-height: 28px;
            font-size: 13px;
            font-weight: bold;
        }
        .game-report {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
            border-left: 3px solid var(--primary);
        }
        .report-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--dark);
        }
        .report-item {
            margin: 3px 0;
            display: flex;
            justify-content: space-between;
        }
        .report-good {
            color: var(--success);
        }
        .report-bad {
            color: var(--danger);
        }
        .report-neutral {
            color: var(--warning);
        }
        .report-strategy {
            font-weight: 500;
        }
        .report-details {
            margin-top: 8px;
            font-size: 13px;
            color: #555;
        }
        .strategy-tag {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            margin-right: 5px;
        }
        .tag-balanced {
            background-color: #d5f5e3;
            color: var(--success);
        }
        .tag-primes {
            background-color: #d1f2eb;
            color: var(--prime);
        }
        .tag-extremes {
            background-color: #fadbd8;
            color: var(--extreme);
        }
        .tag-unique {
            background-color: #eaf2f8;
            color: var(--primary);
        }
        .rating-stars {
            color: var(--warning);
            font-weight: bold;
        }
        .cycle-info {
            margin-top: 10px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            font-size: 14px;
        }
        .info-section {
            background-color: #eaf2f8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 5px solid var(--primary);
        }
        .number-groups {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .number-group {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        .number-group-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--dark);
            border-bottom: 1px solid #ddd;
            padding-bottom: 5px;
        }
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .stats-table th, .stats-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
        }
        .stats-table th {
            background-color: var(--dark);
            color: white;
        }
        .stats-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        .strategy-options {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .draw {
            background-color: #f8f9fa;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .draw-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--dark);
        }
        .draw-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .draw-number {
            display: inline-block;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            text-align: center;
            line-height: 28px;
            font-size: 13px;
        }
        @media (max-width: 768px) {
            .features-grid, .stats-grid, .game-controls, .number-groups {
                grid-template-columns: 1fr;
            }
            .section {
                padding: 15px;
            }
            .strategy-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>
</head>
<body>
    <div class="container">
        <h1>Gerador Inteligente de Jogos Lotofácil</h1>
        <p class="subtitle">Estratégia Combinada - Análise Estatística e Geração Otimizada</p>
        
        <div class="info-section">
            <h2>Estratégias Avançadas Combinadas</h2>
            <p>Este gerador utiliza técnicas estatísticas combinadas para aumentar suas chances na Lotofácil:</p>
            <ul>
                <li><strong>Análise de Frequência</strong> - Identifica números quentes (mais sorteados) e frios (menos sorteados)</li>
                <li><strong>Detecção de Ciclos</strong> - Encontra números atrasados e padrões de repetição</li>
                <li><strong>Números Primos</strong> - Prioriza números primos (2,3,5,7,11,13,17,19,23)</li>
                <li><strong>Balanceamento Par/Ímpar</strong> - Proporção ideal de 7-8 ou 8-7</li>
                <li><strong>Números Extremos</strong> - Foco especial nas bolas 1 e 25</li>
                <li><strong>Combinações Únicas</strong> - Evita jogos que já foram premiados</li>
                <li><strong>Ciclo de Dezenas Não Sorteadas</strong> - Identifica números que não apareceram nos últimos concursos</li>
            </ul>
            <button id="load-results">Atualizar Dados <span id="loading-spinner" class="loading" style="display: none;"></span></button>
            <div id="api-status" style="margin-top: 12px; font-style: italic; color: #555;"></div>
            <div id="error-message" class="error-message" style="display: none;"></div>
        </div>
        
        <div id="loadingIndicator" class="loading">
            <div class="spinner"></div>
            <p>Carregando dados e analisando resultados...</p>
        </div>
        
        <div id="mainContent" style="display: none;">
            <div id="last-results" class="section">
                <h2>Últimos 10 Sorteios</h2>
                <div id="draws-container"></div>
                
                <h2>Estatísticas Detalhadas</h2>
                <table class="stats-table">
                    <thead>
                        <tr>
                            <th>Número</th>
                            <th>Frequência</th>
                            <th>Último Sorteio</th>
                            <th>Atraso</th>
                            <th>Tipo</th>
                        </tr>
                    </thead>
                    <tbody id="stats-body">
                    </tbody>
                </table>
            </div>
            
            <div class="section">
                <h2>Análise de Frequência</h2>
                <div class="chart-container">
                    <canvas id="frequencyChart"></canvas>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Números Quentes</h4>
                        <div class="stat-value" style="color: var(--hot);">
                            <span id="hot-numbers"></span>
                        </div>
                        <p>Mais sorteados nos últimos concursos</p>
                    </div>
                    <div class="stat-card">
                        <h4>Números Frios</h4>
                        <div class="stat-value" style="color: var(--cold);">
                            <span id="cold-numbers"></span>
                        </div>
                        <p>Menos sorteados nos últimos concursos</p>
                    </div>
                    <div class="stat-card">
                        <h4>Números Primos</h4>
                        <div class="stat-value" style="color: var(--prime);">
                            <span id="prime-numbers"></span>
                        </div>
                        <p>Números primos com boa frequência</p>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>Análise Combinatória</h2>
                <div class="chart-container">
                    <canvas id="oddEvenChart"></canvas>
                </div>
                <div class="chart-container">
                    <canvas id="tensChart"></canvas>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Números Não Sorteados (Último)</h4>
                        <div class="stat-value">
                            <span id="not-drawn-last-numbers"></span>
                        </div>
                        <p>Não apareceram no último concurso</p>
                    </div>
                    <div class="stat-card">
                        <h4>Números Não Sorteados (5 concursos)</h4>
                        <div class="stat-value">
                            <span id="not-drawn-numbers"></span>
                        </div>
                        <p>Não apareceram nos últimos 5 concursos</p>
                    </div>
                </div>
                
                <div id="cycle-info" class="cycle-info"></div>
            </div>
            
            <div class="section">
                <h2>Configurações do Gerador</h2>
                
                <div class="strategy-options">
                    <h3>Estratégias Avançadas</h3>
                    <div>
                        <input type="checkbox" id="avoid-repeated" checked>
                        <label for="avoid-repeated">Evitar combinações já sorteadas</label>
                    </div>
                    <div>
                        <input type="checkbox" id="balance-parity" checked>
                        <label for="balance-parity">Balancear pares e ímpares (7-8 ou 8-7)</label>
                    </div>
                    <div>
                        <input type="checkbox" id="use-primes" checked>
                        <label for="use-primes">Usar números primos (2,3,5,7,11,13,17,19,23)</label>
                        <div class="prime-explanation">Números primos aparecem em ~70% dos sorteios</div>
                    </div>
                    <div>
                        <input type="checkbox" id="double-premium">
                        <label for="double-premium">Dobrar premiação (gerar com 16-17 números)</label>
                    </div>
                    <div>
                        <input type="checkbox" id="watch-extremes" checked>
                        <label for="watch-extremes">Atentar para números extremos (bolas 1 e 25)</label>
                    </div>
                    <div>
                        <input type="checkbox" id="use-not-drawn-cycle" checked>
                        <label for="use-not-drawn-cycle">Usar ciclo de dezenas não sorteadas</label>
                    </div>
                </div>
                
                <div class="game-controls">
                    <div class="control-group">
                        <h3>Números Fixos (Máx. 15)</h3>
                        <div id="fixed-numbers-container"></div>
                    </div>
                    
                    <div class="control-group">
                        <h3>Números para Excluir</h3>
                        <div id="excluded-numbers-container"></div>
                    </div>
                    
                    <div class="control-group">
                        <h3>Opções de Geração</h3>
                        <label for="game-count">Quantidade de jogos:</label>
                        <input type="number" id="game-count" min="1" max="20" value="5" style="padding: 8px; width: 60px;">
                        
                        <div class="strategy-buttons">
                            <button id="generate-games" class="secondary">Gerar Jogos Inteligentes</button>
                            <button id="generate-cold" class="tertiary">Focar em Números Atrasados</button>
                            <button id="generate-not-drawn" class="tertiary">Usar Números Não Sorteados</button>
                            <button id="generate-not-drawn-cycle" class="tertiary">Usar Ciclo de Não Sorteados</button>
                            <button id="generate-balanced">Jogo Balanceado</button>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <button id="clear-selections">Limpar Seleções</button>
                            <button id="save-games" style="margin-left: 10px;">Salvar Jogos</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2>Recomendações para Próximo Jogo</h2>
                <div class="recommendation-card">
                    <h3 style="margin-top: 0;">Números Sugeridos</h3>
                    <div id="recommended-numbers" style="margin: 15px 0; font-size: 1.2em;"></div>
                    
                    <h3>Estratégia Recomendada</h3>
                    <ul id="strategy-recommendation">
                        <li>Balancear entre <strong>7 ímpares</strong> e <strong>8 pares</strong></li>
                        <li>Incluir <strong>5-7 números primos</strong></li>
                        <li>Adicionar <strong>1-2 números extremos</strong> (1 ou 25)</li>
                        <li>Usar <strong>2-3 números do ciclo ativo</strong></li>
                        <li>Manter proporção de <strong>3-5 números quentes</strong></li>
                    </ul>
                    
                    <p style="margin-top: 20px; font-style: italic;">
                        Observação: Esta é uma análise estatística e não garante acertos. 
                        Loterias são jogos de azar e os resultados são imprevisíveis.
                    </p>
                </div>
            </div>
            
            <div class="section">
                <h2>Jogos Gerados</h2>
                <div id="generated-games" class="generated-games"></div>
            </div>
        </div>
    </div>

    <script>
        // Constantes e configurações
        const PRIME_NUMBERS = [2, 3, 5, 7, 11, 13, 17, 19, 23];
        const MAX_ATTEMPTS = 500;
        const API_URL = "https://servicebus2.caixa.gov.br/portaldeloterias/api/lotofacil";
        
        // Dados globais
        let frequencyData = {};
        let notDrawnNumbers = [];
        let notDrawnLastNumbers = [];
        let lastDraws = [];
        let numberStats = {};
        let fixedNumbers = [];
        let excludedNumbers = [];
        let notDrawnCycleInfo = {};
        
        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            // Configura event listeners
            setupEventListeners();
            
            // Carrega dados salvos localmente
            const savedData = localStorage.getItem('lotofacilData');
            if (savedData) {
                try {
                    const parsedData = JSON.parse(savedData);
                    if (parsedData.lastDraws?.length > 0) {
                        processResults(parsedData);
                        document.getElementById('api-status').textContent = 
                            `Dados carregados do cache (${new Date(parsedData.timestamp).toLocaleString()})`;
                        document.getElementById('loadingIndicator').style.display = 'none';
                        document.getElementById('mainContent').style.display = 'block';
                    }
                } catch (e) {
                    console.error("Erro ao carregar dados salvos:", e);
                    showError("Erro ao carregar dados salvos. Carregando dados oficiais...");
                }
            }
            
            // Carrega dados oficiais
            loadOfficialResults();
        });

        // Configura os listeners de eventos
        function setupEventListeners() {
            document.getElementById('load-results').addEventListener('click', loadOfficialResults);
            document.getElementById('generate-games').addEventListener('click', generateOptimizedGames);
            document.getElementById('generate-cold').addEventListener('click', generateColdGames);
            document.getElementById('generate-not-drawn').addEventListener('click', generateNotDrawnGames);
            document.getElementById('generate-not-drawn-cycle').addEventListener('click', generateNotDrawnCycleGames);
            document.getElementById('generate-balanced').addEventListener('click', generateBalancedGames);
            document.getElementById('clear-selections').addEventListener('click', clearSelections);
            document.getElementById('save-games').addEventListener('click', saveGames);
        }

        // Mostra mensagem de erro
        function showError(message) {
            const errorElement = document.getElementById('error-message');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }

        // Carrega resultados oficiais da Caixa
        async function loadOfficialResults() {
            const loadingSpinner = document.getElementById('loading-spinner');
            const loadResultsBtn = document.getElementById('load-results');
            const apiStatus = document.getElementById('api-status');
            
            try {
                loadingSpinner.style.display = 'inline-block';
                loadResultsBtn.disabled = true;
                apiStatus.textContent = 'Conectando à Caixa Econômica...';
                
                // Usando fetch diretamente com tratamento de CORS
                const response = await fetch(API_URL, {
                    method: 'GET',
                    mode: 'cors',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`Erro na API da Caixa: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Processa os últimos 10 concursos
                if (!Array.isArray(data)) {
                    throw new Error('Formato de dados inválido da API');
                }
                
                lastDraws = data.map(draw => ({
                    numero: draw.numero,
                    data: new Date(draw.dataApuracao).toLocaleDateString(),
                    dezenas: draw.listaDezenas.map(Number)
                })).slice(0, 10).reverse();
                
                calculateStatistics();
                
                // Salva localmente
                const saveData = {
                    lastDraws: lastDraws,
                    frequencyData: frequencyData,
                    notDrawnNumbers: notDrawnNumbers,
                    notDrawnLastNumbers: notDrawnLastNumbers,
                    notDrawnCycleInfo: notDrawnCycleInfo,
                    numberStats: numberStats,
                    timestamp: new Date().toISOString()
                };
                localStorage.setItem('lotofacilData', JSON.stringify(saveData));
                
                updateDrawsDisplay();
                updateStatsTable();
                initializeNumbers();
                updateRecommendedNumbers();
                initCharts();
                
                document.getElementById('loadingIndicator').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                apiStatus.textContent = `Dados oficiais atualizados em ${new Date().toLocaleString()}`;
                
            } catch (error) {
                console.error('Erro ao carregar dados oficiais:', error);
                apiStatus.textContent = 'Erro ao carregar dados oficiais. Usando cache local.';
                
                // Tenta usar dados salvos
                const savedData = localStorage.getItem('lotofacilData');
                if (savedData) {
                    try {
                        const parsedData = JSON.parse(savedData);
                        processResults(parsedData);
                        document.getElementById('loadingIndicator').style.display = 'none';
                        document.getElementById('mainContent').style.display = 'block';
                        showError("Usando dados salvos. Atualização falhou: " + error.message);
                    } catch (e) {
                        showError("Não foi possível carregar dados. Por favor, tente novamente mais tarde.");
                    }
                } else {
                    showError("Não foi possível carregar dados. Por favor, tente novamente mais tarde.");
                }
            } finally {
                loadingSpinner.style.display = 'none';
                loadResultsBtn.disabled = false;
            }
        }

        // Processa os resultados
        function processResults(data) {
            lastDraws = data.lastDraws || [];
            frequencyData = data.frequencyData || {};
            notDrawnNumbers = data.notDrawnNumbers || [];
            notDrawnLastNumbers = data.notDrawnLastNumbers || [];
            notDrawnCycleInfo = data.notDrawnCycleInfo || {};
            numberStats = data.numberStats || {};
            
            calculateStatistics();
            updateDrawsDisplay();
            updateStatsTable();
            initializeNumbers();
            updateRecommendedNumbers();
            initCharts();
        }

        // Calcula estatísticas
        function calculateStatistics() {
            frequencyData = {};
            numberStats = {};
            
            // Inicializa contadores
            for (let i = 1; i <= 25; i++) {
                frequencyData[i] = 0;
                numberStats[i] = {
                    lastDraw: 0,
                    delay: lastDraws.length,
                    isPrime: PRIME_NUMBERS.includes(i)
                };
            }
            
            // Conta frequências e atrasos
            lastDraws.forEach((draw, index) => {
                draw.dezenas.forEach(num => {
                    frequencyData[num]++;
                    numberStats[num].lastDraw = lastDraws.length - index;
                    numberStats[num].delay = 0;
                });
            });
            
            // Calcula atrasos para números não sorteados
            for (let num = 1; num <= 25; num++) {
                if (numberStats[num].delay === 0) continue;
                
                let delay = lastDraws.length;
                for (let i = 0; i < lastDraws.length; i++) {
                    if (lastDraws[i].dezenas.includes(num)) {
                        delay = i;
                        break;
                    }
                }
                numberStats[num].delay = delay;
            }
            
            // Identifica números não sorteados nos últimos 5 concursos
            notDrawnNumbers = [];
            const last5Draws = lastDraws.slice(0, 5);
            const drawnInLast5 = new Set();
            
            last5Draws.forEach(draw => {
                draw.dezenas.forEach(num => drawnInLast5.add(num));
            });
            
            for (let i = 1; i <= 25; i++) {
                if (!drawnInLast5.has(i)) {
                    notDrawnNumbers.push(i);
                }
            }
            
            // Identifica números não sorteados no último concurso
            notDrawnLastNumbers = [];
            if (lastDraws.length > 0) {
                const lastDrawNumbers = lastDraws[0].dezenas;
                for (let i = 1; i <= 25; i++) {
                    if (!lastDrawNumbers.includes(i)) {
                        notDrawnLastNumbers.push(i);
                    }
                }
            }
            
            // Calcula ciclos de números não sorteados nos últimos 10 concursos
            calculateNotDrawnCycles();
            
            // Atualiza números recomendados
            updateRecommendedNumbers();
        }

        // Calcula ciclos de números não sorteados
        function calculateNotDrawnCycles() {
            notDrawnCycleInfo = {};
            
            // Verifica se todos os números foram sorteados nos últimos 10 concursos
            const allNumbersDrawn = new Set();
            lastDraws.forEach(draw => {
                draw.dezenas.forEach(num => allNumbersDrawn.add(num));
            });
            
            const allNumbersWereDrawn = allNumbersDrawn.size === 25;
            
            if (allNumbersWereDrawn) {
                // Se todos os números foram sorteados, reinicia o ciclo
                notDrawnCycleInfo.cycleActive = true;
                notDrawnCycleInfo.cycleStart = lastDraws[0]?.numero || 'N/A';
                notDrawnCycleInfo.numbersNotDrawnInCycle = notDrawnLastNumbers;
            } else {
                // Se não, continua o ciclo atual
                notDrawnCycleInfo.cycleActive = false;
                notDrawnCycleInfo.numbersNotDrawnInCycle = [];
                
                // Identifica números que não foram sorteados nos últimos 10 concursos
                for (let i = 1; i <= 25; i++) {
                    let wasDrawn = false;
                    for (let j = 0; j < lastDraws.length; j++) {
                        if (lastDraws[j].dezenas.includes(i)) {
                            wasDrawn = true;
                            break;
                        }
                    }
                    if (!wasDrawn) {
                        notDrawnCycleInfo.numbersNotDrawnInCycle.push(i);
                    }
                }
            }
            
            // Atualiza a exibição do ciclo
            updateCycleInfoDisplay();
        }

        // Atualiza a exibição das informações do ciclo
        function updateCycleInfoDisplay() {
            const cycleInfoElement = document.getElementById('cycle-info');
            
            if (notDrawnCycleInfo.cycleActive) {
                cycleInfoElement.innerHTML = `
                    <strong>Ciclo Ativo:</strong> Todos os números foram sorteados nos últimos ${lastDraws.length} concursos.<br>
                    <strong>Números não sorteados no último concurso:</strong> ${notDrawnCycleInfo.numbersNotDrawnInCycle.join(', ') || 'Nenhum'}<br>
                    <strong>Quantidade:</strong> ${notDrawnCycleInfo.numbersNotDrawnInCycle.length} números
                `;
            } else if (notDrawnCycleInfo.numbersNotDrawnInCycle.length > 0) {
                cycleInfoElement.innerHTML = `
                    <strong>Ciclo Incompleto:</strong> Alguns números não foram sorteados nos últimos ${lastDraws.length} concursos.<br>
                    <strong>Números atrasados:</strong> ${notDrawnCycleInfo.numbersNotDrawnInCycle.join(', ')}<br>
                    <strong>Quantidade:</strong> ${notDrawnCycleInfo.numbersNotDrawnInCycle.length} números
                `;
            } else {
                cycleInfoElement.innerHTML = `
                    <strong>Status do Ciclo:</strong> Aguardando todos os números serem sorteados nos últimos ${lastDraws.length} concursos.
                `;
            }
        }

        // Atualiza a exibição dos sorteios
        function updateDrawsDisplay() {
            const container = document.getElementById('draws-container');
            container.innerHTML = '';
            
            lastDraws.slice(0, 10).forEach(draw => {
                const drawElement = document.createElement('div');
                drawElement.className = 'draw';
                
                const titleElement = document.createElement('div');
                titleElement.className = 'draw-title';
                titleElement.textContent = `Concurso ${draw.numero} - ${draw.data}`;
                drawElement.appendChild(titleElement);
                
                const numbersElement = document.createElement('div');
                numbersElement.className = 'draw-numbers';
                
                draw.dezenas.forEach(num => {
                    const numElement = document.createElement('div');
                    numElement.className = 'draw-number';
                    
                    // Destaca números extremos
                    if (num === Math.min(...draw.dezenas) || num === Math.max(...draw.dezenas)) {
                        numElement.style.backgroundColor = 'var(--extreme)';
                    } 
                    // Destaca números primos
                    else if (PRIME_NUMBERS.includes(num)) {
                        numElement.style.backgroundColor = 'var(--prime)';
                    }
                    
                    numElement.textContent = num;
                    numbersElement.appendChild(numElement);
                });
                
                drawElement.appendChild(numbersElement);
                container.appendChild(drawElement);
            });
        }

        // Atualiza a tabela de estatísticas
        function updateStatsTable() {
            const tbody = document.getElementById('stats-body');
            tbody.innerHTML = '';
            
            for (let num = 1; num <= 25; num++) {
                const row = document.createElement('tr');
                
                // Destaca linhas com base nas características
                if (numberStats[num].isPrime) {
                    row.classList.add('highlight');
                }
                
                const numCell = document.createElement('td');
                numCell.textContent = num;
                if (numberStats[num].isPrime) {
                    numCell.innerHTML += ' <span style="color:var(--prime);">●</span>';
                }
                row.appendChild(numCell);
                
                const freqCell = document.createElement('td');
                freqCell.textContent = frequencyData[num];
                row.appendChild(freqCell);
                
                const lastCell = document.createElement('td');
                lastCell.textContent = numberStats[num].lastDraw || '-';
                row.appendChild(lastCell);
                
                const delayCell = document.createElement('td');
                delayCell.textContent = numberStats[num].delay;
                row.appendChild(delayCell);
                
                const typeCell = document.createElement('td');
                let typeText = '';
                if (numberStats[num].isPrime) typeText += 'Primo, ';
                if (frequencyData[num] >= 8) typeText += 'Quente';
                else if (frequencyData[num] <= 3) typeText += 'Frio';
                else typeText += 'Normal';
                
                typeCell.textContent = typeText;
                row.appendChild(typeCell);
                
                tbody.appendChild(row);
            }
        }

        // Inicializa os números interativos
        function initializeNumbers() {
            const fixedContainer = document.getElementById('fixed-numbers-container');
            const excludedContainer = document.getElementById('excluded-numbers-container');
            const hotContainer = document.getElementById('hot-numbers');
            const coldContainer = document.getElementById('cold-numbers');
            const notDrawnContainer = document.getElementById('not-drawn-numbers');
            const notDrawnLastContainer = document.getElementById('not-drawn-last-numbers');
            const primeContainer = document.getElementById('prime-numbers');
            
            fixedContainer.innerHTML = '';
            excludedContainer.innerHTML = '';
            hotContainer.innerHTML = '';
            coldContainer.innerHTML = '';
            notDrawnContainer.innerHTML = '';
            notDrawnLastContainer.innerHTML = '';
            primeContainer.innerHTML = '';
            
            // Cria todas as bolas de 1 a 25
            for (let i = 1; i <= 25; i++) {
                // Bolas para seleção fixa
                const fixedBall = createNumberBall(i, 'fixed');
                fixedContainer.appendChild(fixedBall);
                
                // Bolas para exclusão
                const excludedBall = createNumberBall(i, 'excluded');
                excludedContainer.appendChild(excludedBall);
            }
            
            // Agrupa números quentes (frequentes)
            const hotNumbers = getTopNumbersByFrequency(5);
            hotNumbers.forEach(num => {
                const ball = createNumberBall(num, 'hot');
                hotContainer.appendChild(ball);
            });
            
            // Agrupa números frios (raros)
            const coldNumbers = getColdNumbers(5);
            coldNumbers.forEach(num => {
                const ball = createNumberBall(num, 'cold');
                coldContainer.appendChild(ball);
            });
            
            // Agrupa números não sorteados nos últimos 5 concursos
            notDrawnNumbers.forEach(num => {
                const ball = createNumberBall(num, 'not-drawn');
                notDrawnContainer.appendChild(ball);
            });
            
            // Agrupa números não sorteados no último concurso
            notDrawnLastNumbers.forEach(num => {
                const ball = createNumberBall(num, 'not-drawn-last');
                notDrawnLastContainer.appendChild(ball);
            });
            
            // Agrupa números primos
            PRIME_NUMBERS.forEach(num => {
                const ball = createNumberBall(num, 'prime');
                primeContainer.appendChild(ball);
            });
        }

        // Atualiza os números recomendados
        function updateRecommendedNumbers() {
            const recommendedContainer = document.getElementById('recommended-numbers');
            recommendedContainer.innerHTML = '';
            
            // Obtém números recomendados baseados em múltiplas estratégias
            const recommended = getRecommendedNumbers();
            
            recommended.forEach(num => {
                let ballClass = 'number-ball';
                
                if (PRIME_NUMBERS.includes(num)) ballClass += ' prime';
                if (getTopNumbersByFrequency(8).includes(num)) ballClass += ' hot';
                if (getColdNumbers(8).includes(num)) ballClass += ' cold';
                if (notDrawnLastNumbers.includes(num)) ballClass += ' not-drawn-last';
                if (num === 1 || num === 25) ballClass += ' extreme';
                
                const ball = document.createElement('span');
                ball.className = ballClass;
                ball.textContent = num;
                recommendedContainer.appendChild(ball);
            });
        }

        // Obtém números recomendados baseados em múltiplas estratégias
        function getRecommendedNumbers() {
            const recommended = new Set();
            
            // Adiciona 3-5 números quentes
            const hotNumbers = getTopNumbersByFrequency(8);
            const hotToAdd = hotNumbers
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(hotNumbers.length, Math.floor(Math.random() * 3) + 3));
            hotToAdd.forEach(num => recommended.add(num));
            
            // Adiciona 2-3 números frios
            const coldNumbers = getColdNumbers(5);
            const coldToAdd = coldNumbers
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(coldNumbers.length, Math.floor(Math.random() * 2) + 2));
            coldToAdd.forEach(num => recommended.add(num));
            
            // Adiciona 2-3 números primos (que ainda não estão na lista)
            const availablePrimes = PRIME_NUMBERS.filter(num => !recommended.has(num));
            const primesToAdd = availablePrimes
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(availablePrimes.length, Math.floor(Math.random() * 2) + 2));
            primesToAdd.forEach(num => recommended.add(num));
            
            // Adiciona 1-2 números extremos (1 ou 25)
            if (!recommended.has(1) && !recommended.has(25)) {
                recommended.add(Math.random() > 0.5 ? 1 : 25);
            }
            
            // Adiciona 2-3 números do ciclo não sorteados (se disponível)
            if (notDrawnCycleInfo.cycleActive && notDrawnCycleInfo.numbersNotDrawnInCycle.length > 0) {
                const cycleToAdd = notDrawnCycleInfo.numbersNotDrawnInCycle
                    .sort(() => Math.random() - 0.5)
                    .slice(0, Math.min(notDrawnCycleInfo.numbersNotDrawnInCycle.length, Math.floor(Math.random() * 2) + 2));
                cycleToAdd.forEach(num => recommended.add(num));
            }
            
            return Array.from(recommended).sort((a, b) => a - b);
        }

        // Cria uma bola de número interativa
        function createNumberBall(number, type) {
            const ball = document.createElement('span');
            ball.className = 'number-ball';
            ball.textContent = number;
            ball.dataset.number = number;
            
            // Adiciona classes baseadas no tipo
            if (type === 'fixed') {
                if (fixedNumbers.includes(number)) ball.classList.add('fixed');
            } else if (type === 'excluded') {
                if (excludedNumbers.includes(number)) ball.classList.add('excluded');
            } else if (type === 'hot') {
                ball.classList.add('hot');
            } else if (type === 'cold') {
                ball.classList.add('cold');
            } else if (type === 'not-drawn') {
                ball.classList.add('not-drawn');
            } else if (type === 'not-drawn-last') {
                ball.classList.add('not-drawn-last');
            } else if (type === 'prime') {
                ball.classList.add('prime');
            }
            
            // Configura o clique
            ball.addEventListener('click', () => {
                if (type === 'fixed' || type === 'hot' || type === 'cold' || type === 'not-drawn' || type === 'not-drawn-last' || type === 'prime') {
                    toggleFixedNumber(number);
                } else if (type === 'excluded') {
                    toggleExcludedNumber(number);
                }
            });
            
            return ball;
        }

        // Alterna número fixo
        function toggleFixedNumber(number) {
            const index = fixedNumbers.indexOf(number);
            
            if (index === -1) {
                if (fixedNumbers.length < 15) {
                    fixedNumbers.push(number);
                    
                    // Remove dos excluídos se estiver lá
                    const excludedIndex = excludedNumbers.indexOf(number);
                    if (excludedIndex !== -1) {
                        excludedNumbers.splice(excludedIndex, 1);
                    }
                } else {
                    alert('Você só pode selecionar no máximo 15 números fixos!');
                    return;
                }
            } else {
                fixedNumbers.splice(index, 1);
            }
            
            // Atualiza a exibição
            initializeNumbers();
        }

        // Alterna número excluído
        function toggleExcludedNumber(number) {
            const index = excludedNumbers.indexOf(number);
            
            if (index === -1) {
                excludedNumbers.push(number);
                
                // Remove dos fixos se estiver lá
                const fixedIndex = fixedNumbers.indexOf(number);
                if (fixedIndex !== -1) {
                    fixedNumbers.splice(fixedIndex, 1);
                }
            } else {
                excludedNumbers.splice(index, 1);
            }
            
            // Atualiza a exibição
            initializeNumbers();
        }

        // Obtém os números mais frequentes
        function getTopNumbersByFrequency(count) {
            return Object.entries(frequencyData)
                .sort((a, b) => b[1] - a[1])
                .slice(0, count)
                .map(([num]) => Number(num));
        }

        // Obtém os números mais atrasados
        function getColdNumbers(count) {
            return Object.entries(numberStats)
                .sort((a, b) => b[1].delay - a[1].delay)
                .slice(0, count)
                .map(([num]) => Number(num));
        }

        // Gera números aleatórios com estratégias
        function generateRandomNumbers(count, exclude = []) {
            const available = [];
            for (let i = 1; i <= 25; i++) {
                if (!exclude.includes(i) && !excludedNumbers.includes(i)) {
                    available.push(i);
                }
            }
            
            if (available.length < count) {
                alert('Não há números suficientes disponíveis com as configurações atuais!');
                return [];
            }
            
            // Embaralha os números disponíveis
            const shuffled = [...available].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, count).sort((a, b) => a - b);
        }

        // Verifica se uma combinação já foi sorteada
        function isRepeatedCombination(numbers) {
            if (!document.getElementById('avoid-repeated').checked) return false;
            
            return lastDraws.some(draw => {
                const drawNumbers = draw.dezenas.map(Number);
                return arraysEqual(numbers.sort(), drawNumbers.sort());
            });
        }

        // Compara arrays
        function arraysEqual(a, b) {
            if (a.length !== b.length) return false;
            for (let i = 0; i < a.length; i++) {
                if (a[i] !== b[i]) return false;
            }
            return true;
        }

        // Verifica balanceamento par/ímpar
        function isBalancedParity(numbers) {
            if (!document.getElementById('balance-parity').checked) return true;
            
            const evens = numbers.filter(n => n % 2 === 0).length;
            const odds = numbers.length - evens;
            return Math.abs(evens - odds) <= 1; // Diferença de no máximo 1
        }

        // Verifica números primos
        function hasGoodPrimeCount(numbers) {
            if (!document.getElementById('use-primes').checked) return true;
            
            const primes = numbers.filter(n => PRIME_NUMBERS.includes(n)).length;
            return primes >= 5 && primes <= 7; // Entre 5 e 7 primos
        }

        // Verifica números extremos
        function hasGoodExtremes(numbers) {
            if (!document.getElementById('watch-extremes').checked) return true;
            
            const sorted = [...numbers].sort((a, b) => a - b);
            const first = sorted[0];
            const last = sorted[sorted.length - 1];
            
            // Pelo menos um dos extremos deve ser quente ou primo
            return (
                frequencyData[first] >= 7 || 
                frequencyData[last] >= 7 || 
                PRIME_NUMBERS.includes(first) || 
                PRIME_NUMBERS.includes(last)
            );
        }

        // Verifica se o jogo usa números do ciclo não sorteados
        function usesNotDrawnCycleNumbers(numbers) {
            if (!document.getElementById('use-not-drawn-cycle').checked) return true;
            if (!notDrawnCycleInfo.cycleActive) return true;
            
            // Verifica se pelo menos 2 números não sorteados no último concurso estão no jogo
            const intersection = numbers.filter(num => notDrawnCycleInfo.numbersNotDrawnInCycle.includes(num));
            return intersection.length >= 2;
        }

        // Gera números balanceados para completar o jogo
        function generateBalancedNumbers(count, currentNumbers) {
            const needed = count;
            const numbers = [...currentNumbers];
            const available = [];
            
            for (let i = 1; i <= 25; i++) {
                if (!numbers.includes(i) && !excludedNumbers.includes(i)) {
                    available.push(i);
                }
            }
            
            if (available.length < needed) {
                return [];
            }
            
            let attempts = 0;
            const maxAttempts = 100;
            let balancedNumbers = [];
            
            while (attempts < maxAttempts) {
                const candidates = [...available].sort(() => Math.random() - 0.5).slice(0, needed);
                const testNumbers = [...numbers, ...candidates].sort((a, b) => a - b);
                
                if (isBalancedParity(testNumbers) && 
                    hasGoodPrimeCount(testNumbers) && 
                    hasGoodExtremes(testNumbers)) {
                    balancedNumbers = candidates;
                    break;
                }
                
                attempts++;
            }
            
            return balancedNumbers.length > 0 ? balancedNumbers : 
                [...available].sort(() => Math.random() - 0.5).slice(0, needed);
        }

        // Gera relatório detalhado do jogo
        function generateGameReport(numbers) {
            const sorted = [...numbers].sort((a, b) => a - b);
            const firstExtreme = sorted[0];
            const lastExtreme = sorted[sorted.length - 1];
            
            const evens = numbers.filter(n => n % 2 === 0).length;
            const odds = numbers.length - evens;
            const primes = numbers.filter(n => PRIME_NUMBERS.includes(n)).length;
            const primesList = numbers.filter(n => PRIME_NUMBERS.includes(n)).join(', ');
            
            const isBalanced = isBalancedParity(numbers);
            const hasGoodPrimes = hasGoodPrimeCount(numbers);
            const hasGoodExtremesValue = hasGoodExtremes(numbers);
            const isRepeated = isRepeatedCombination(numbers);
            const isDoublePremium = numbers.length > 15;
            const usesCycleNumbers = usesNotDrawnCycleNumbers(numbers);
            
            // Calcula score de qualidade
            let score = 0;
            if (isBalanced) score += 20;
            if (hasGoodPrimes) score += 20;
            if (hasGoodExtremesValue) score += 15;
            if (!isRepeated) score += 25;
            if (usesCycleNumbers) score += 20;
            
            // Classificação
            let rating = "";
            let stars = "";
            if (score >= 90) {
                rating = "Excelente";
                stars = "★★★★★";
            } else if (score >= 75) {
                rating = "Muito Bom";
                stars = "★★★★";
            } else if (score >= 60) {
                rating = "Bom";
                stars = "★★★";
            } else if (score >= 40) {
                rating = "Regular";
                stars = "★★";
            } else {
                rating = "Básico";
                stars = "★";
            }
            
            // Cria o relatório
            const report = document.createElement('div');
            report.className = 'game-report';
            
            report.innerHTML = `
                <div class="report-title">Relatório de Estratégia</div>
                
                <div class="report-item">
                    <span class="report-strategy">Classificação:</span>
                    <strong>${rating} <span class="rating-stars">${stars}</span></strong>
                </div>
                
                <div class="report-item">
                    <span class="report-strategy">Tipo:</span>
                    <span>${isDoublePremium ? 'Jogo Premium (' + numbers.length + ' números)' : 'Jogo Padrão (15 números)'}</span>
                </div>
                
                <div class="report-item">
                    <span class="report-strategy">Pares/Ímpares:</span>
                    <span class="${isBalanced ? 'report-good' : 'report-bad'}">
                        ${evens} pares | ${odds} ímpares
                        ${isBalanced ? '(Balanceado)' : '(Desequilibrado)'}
                    </span>
                </div>
                
                <div class="report-item">
                    <span class="report-strategy">Números Primos:</span>
                    <span class="${hasGoodPrimes ? 'report-good' : 'report-bad'}">
                        ${primes} primos (${primesList}) ${hasGoodPrimes ? '(Ótimo)' : '(Fora da faixa ideal)'}
                    </span>
                </div>
                
                <div class="report-item">
                    <span class="report-strategy">Extremos (${firstExtreme} e ${lastExtreme}):</span>
                    <span class="${hasGoodExtremesValue ? 'report-good' : 'report-neutral'}">
                        ${hasGoodExtremesValue ? 'Bons números' : 'Pode melhorar'}
                    </span>
                </div>
                
                <div class="report-item">
                    <span class="report-strategy">Combinação única:</span>
                    <span class="${!isRepeated ? 'report-good' : 'report-bad'}">
                        ${!isRepeated ? 'Nunca sorteada' : 'Já sorteada antes'}
                    </span>
                </div>
                
                <div class="report-item">
                    <span class="report-strategy">Ciclo de não sorteados:</span>
                    <span class="${usesCycleNumbers ? 'report-good' : 'report-neutral'}">
                        ${usesCycleNumbers ? 'Usa números do ciclo' : 'Não usa números do ciclo'}
                    </span>
                </div>
                
                <div class="report-details">
                    <div><span class="strategy-tag tag-balanced">Balanceado</span> ${isBalanced ? '✔' : '✖'} Diferença de ${Math.abs(evens - odds)} entre pares/ímpares</div>
                    <div><span class="strategy-tag tag-primes">Primos</span> ${hasGoodPrimes ? '✔' : '✖'} ${primes} números primos (ideal 5-7)</div>
                    <div><span class="strategy-tag tag-extremes">Extremos</span> ${hasGoodExtremesValue ? '✔' : '✖'} ${firstExtreme} (freq. ${frequencyData[firstExtreme]}) e ${lastExtreme} (freq. ${frequencyData[lastExtreme]})</div>
                    <div><span class="strategy-tag tag-unique">Único</span> ${!isRepeated ? '✔' : '✖'} Combinação ${!isRepeated ? 'nunca sorteada' : 'já apareceu antes'}</div>
                    <div><span class="strategy-tag">Ciclo</span> ${usesCycleNumbers ? '✔' : '✖'} ${usesCycleNumbers ? 'Usa ' + numbers.filter(n => notDrawnCycleInfo.numbersNotDrawnInCycle.includes(n)).length + ' números do ciclo' : 'Não usa números do ciclo'}</div>
                </div>
            `;
            
            return report;
        }

        // Gera jogos otimizados com estratégia combinada
        function generateOptimizedGames() {
            const gameCount = parseInt(document.getElementById('game-count').value) || 5;
            const isDoublePremium = document.getElementById('double-premium').checked;
            const gameSize = isDoublePremium ? (Math.random() > 0.5 ? 16 : 17) : 15;
            
            const gamesContainer = document.getElementById('generated-games');
            gamesContainer.innerHTML = '';
            
            let generatedGames = 0;
            let attempts = 0;
            const maxAttempts = 500;
            
            while (generatedGames < gameCount && attempts < maxAttempts) {
                attempts++;
                
                // 1. Começa com números fixos selecionados pelo usuário
                let numbers = [...fixedNumbers];
                
                // 2. Se não houver números fixos, usa a estratégia recomendada
                if (numbers.length === 0) {
                    const recommended = getRecommendedNumbers();
                    numbers = recommended.slice(0, Math.min(recommended.length, 5));
                }
                
                // 3. Completa com números aleatórios balanceados
                const needed = gameSize - numbers.length;
                if (needed > 0) {
                    const balancedNumbers = generateBalancedNumbers(needed, numbers);
                    numbers = [...numbers, ...balancedNumbers].sort((a, b) => a - b);
                }
                
                // 4. Verifica se o jogo atende aos critérios de qualidade
                if (isHighQualityGame(numbers)) {
                    const gameElement = document.createElement('div');
                    gameElement.className = 'game';
                    
                    const titleElement = document.createElement('div');
                    titleElement.className = 'game-title';
                    titleElement.textContent = `Jogo ${generatedGames + 1}`;
                    gameElement.appendChild(titleElement);
                    
                    const numbersElement = document.createElement('div');
                    numbersElement.className = 'game-numbers';
                    
                    numbers.forEach(num => {
                        const numElement = document.createElement('div');
                        numElement.className = 'game-number';
                        
                        if (PRIME_NUMBERS.includes(num)) numElement.classList.add('prime-number');
                        if (num === 1 || num === 25) numElement.classList.add('extreme-number');
                        if (notDrawnLastNumbers.includes(num)) numElement.classList.add('not-drawn-last-number');
                        
                        numElement.textContent = num;
                        numbersElement.appendChild(numElement);
                    });
                    
                    gameElement.appendChild(numbersElement);
                    gameElement.appendChild(generateGameReport(numbers));
                    gamesContainer.appendChild(gameElement);
                    
                    generatedGames++;
                }
            }
            
            if (generatedGames < gameCount) {
                showError(`Apenas ${generatedGames} jogos foram gerados que atendem a todos os critérios.`);
            }
        }

        // Verifica se um jogo é de alta qualidade
        function isHighQualityGame(numbers) {
            return (
                !isRepeatedCombination(numbers) &&
                isBalancedParity(numbers) &&
                hasGoodPrimeCount(numbers) &&
                hasGoodExtremes(numbers) &&
                usesNotDrawnCycleNumbers(numbers)
            );
        }

        // Gera jogos com números atrasados
        function generateColdGames() {
            const coldNumbers = getColdNumbers(5).filter(num => !excludedNumbers.includes(num));
            
            if (coldNumbers.length === 0) {
                alert('Não há números atrasados disponíveis!');
                return;
            }
            
            // Seleciona 5-8 números frios aleatoriamente
            const coldToUse = coldNumbers
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(coldNumbers.length, Math.floor(Math.random() * 4) + 5));
            
            fixedNumbers = [...new Set([...fixedNumbers, ...coldToUse])];
            initializeNumbers();
            generateOptimizedGames();
        }

        // Gera jogos com números não sorteados
        function generateNotDrawnGames() {
            const availableNotDrawn = notDrawnNumbers.filter(num => !excludedNumbers.includes(num));
            
            if (availableNotDrawn.length === 0) {
                alert('Não há números não sorteados disponíveis!');
                return;
            }
            
            // Seleciona 3-5 números não sorteados
            const notDrawnToUse = availableNotDrawn
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(availableNotDrawn.length, Math.floor(Math.random() * 3) + 3));
            
            fixedNumbers = [...new Set([...fixedNumbers, ...notDrawnToUse])];
            initializeNumbers();
            generateOptimizedGames();
        }

        // Gera jogos com números do ciclo não sorteados
        function generateNotDrawnCycleGames() {
            if (!notDrawnCycleInfo.cycleActive || notDrawnCycleInfo.numbersNotDrawnInCycle.length === 0) {
                alert('O ciclo de números não sorteados não está ativo ou não há números disponíveis!');
                return;
            }
            
            const availableCycleNumbers = notDrawnCycleInfo.numbersNotDrawnInCycle.filter(num => !excludedNumbers.includes(num));
            
            // Seleciona 2-3 números do ciclo
            const cycleToUse = availableCycleNumbers
                .sort(() => Math.random() - 0.5)
                .slice(0, Math.min(availableCycleNumbers.length, Math.floor(Math.random() * 2) + 2));
            
            fixedNumbers = [...new Set([...fixedNumbers, ...cycleToUse])];
            initializeNumbers();
            generateOptimizedGames();
        }

        // Gera jogos balanceados
        function generateBalancedGames() {
            // Limpa números fixos para começar do zero
            fixedNumbers = [];
            initializeNumbers();
            
            // Gera jogos otimizados com foco no balanceamento
            generateOptimizedGames();
        }

        // Limpa seleções
        function clearSelections() {
            fixedNumbers = [];
            excludedNumbers = [];
            initializeNumbers();
            document.getElementById('generated-games').innerHTML = '';
        }

        // Salva jogos gerados
        function saveGames() {
            const games = [];
            const gameElements = document.querySelectorAll('.game');
            
            gameElements.forEach(game => {
                const numbers = [];
                game.querySelectorAll('.game-number').forEach(num => {
                    numbers.push(parseInt(num.textContent));
                });
                games.push(numbers);
            });
            
            if (games.length === 0) {
                alert('Nenhum jogo foi gerado para salvar!');
                return;
            }
            
            const content = games.map((game, index) => 
                `Jogo ${index + 1}: ${game.join(', ')}`).join('\n');
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'jogos_lotofacil.txt';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Inicializa gráficos
        function initCharts() {
            // Gráfico de frequência
            new Chart(document.getElementById('frequencyChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: Object.keys(frequencyData),
                    datasets: [{
                        label: 'Frequência',
                        data: Object.values(frequencyData),
                        backgroundColor: Object.values(frequencyData).map(freq => 
                            `hsl(${200 + (freq * 10)}, 70%, 60%)`),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: ctx => `${ctx.raw} sorteios (${((ctx.raw / lastDraws.length) * 100).toFixed(1)}%)`
                            }
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            title: { display: true, text: 'Número de Sorteios' }
                        },
                        x: { 
                            title: { display: true, text: 'Números da Lotofácil' }
                        }
                    }
                }
            });
            
            // Gráfico de pares/ímpares
            const oddEven = lastDraws.reduce((acc, res) => {
                const evenCount = res.dezenas.filter(n => n % 2 === 0).length;
                acc.even += evenCount;
                acc.odd += (15 - evenCount);
                return acc;
            }, { odd: 0, even: 0 });
            
            new Chart(document.getElementById('oddEvenChart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Ímpares', 'Pares'],
                    datasets: [{
                        data: [oddEven.odd, oddEven.even],
                        backgroundColor: ['#e74c3c', '#3498db'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Distribuição Pares/Ímpares',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: ctx => `${ctx.label}: ${ctx.raw} (${((ctx.raw / (oddEven.odd + oddEven.even)) * 100).toFixed(1)}%)`
                            }
                        }
                    }
                }
            });
            
            // Gráfico de distribuição por dezenas
            const tensDistribution = {
                '1-5': 0, '6-10': 0, '11-15': 0, '16-20': 0, '21-25': 0
            };
            
            lastDraws.forEach(res => {
                res.dezenas.forEach(num => {
                    if (num <= 5) tensDistribution['1-5']++;
                    else if (num <= 10) tensDistribution['6-10']++;
                    else if (num <= 15) tensDistribution['11-15']++;
                    else if (num <= 20) tensDistribution['16-20']++;
                    else tensDistribution['21-25']++;
                });
            });
            
            new Chart(document.getElementById('tensChart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: Object.keys(tensDistribution),
                    datasets: [{
                        label: 'Números por Faixa',
                        data: Object.values(tensDistribution),
                        backgroundColor: ['#1abc9c', '#2ecc71', '#3498db', '#9b59b6', '#e74c3c'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Distribuição por Faixas de Dezenas',
                            font: { size: 16 }
                        }
                    },
                    scales: {
                        y: { 
                            beginAtZero: true,
                            title: { display: true, text: 'Quantidade de Números' }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
